<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.118.2">
    <meta name="generator" content="Relearn 5.20.0">
    <meta name="description" content="站在巨人的肩膀上">
    <meta name="author" content="月明之都">
    <title>主页 :: 巨人之海</title>
    <link href="https://irscript.github.io/index.html" rel="canonical" type="text/html" title="主页 :: 巨人之海">
    <link href="./index.xml" rel="alternate" type="application/rss+xml" title="主页 :: 巨人之海"><link rel="icon" href="./images/favicon.png" type="image/png">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="./css/fontawesome-all.min.css?1696231135" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="./css/fontawesome-all.min.css?1696231135" rel="stylesheet"></noscript>
    <link href="./css/nucleus.css?1696231135" rel="stylesheet">
    <link href="./css/auto-complete.css?1696231135" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="./css/auto-complete.css?1696231135" rel="stylesheet"></noscript>
    <link href="./css/perfect-scrollbar.min.css?1696231135" rel="stylesheet">
    <link href="./css/fonts.css?1696231135" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="./css/fonts.css?1696231135" rel="stylesheet"></noscript>
    <link href="./css/theme.css?1696231135" rel="stylesheet">
    <link href="./css/theme-auto.css?1696231135" rel="stylesheet" id="variant-style">
    <link href="./css/variant.css?1696231135" rel="stylesheet">
    <link href="./css/print.css?1696231135" rel="stylesheet" media="print">
    <link href="./css/format-print.css?1696231135" rel="stylesheet">
    <link href="./css/ie.css?1696231135" rel="stylesheet">
    <script src="./js/url.js?1696231135"></script>
    <script src="./js/variant.js?1696231135"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="./index.search.js";
      var root_url="./";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = '复制到剪贴板';
      window.T_Copied_to_clipboard = '复制到剪贴板！';
      window.T_Copy_link_to_clipboard = '将链接复制到剪贴板';
      window.T_Link_copied_to_clipboard = '链接复制到剪贴板！';
      window.T_No_results_found = '找不到\u0022{0}\u0022的结果';
      window.T_N_results_found = '为\u0022{0}\u0022找到 {1} 个结果';
      // some further base stuff
      var baseUriFull='https:\/\/irscript.github.io/';
      window.variants && variants.init( [ 'auto', 'relearn-bright', 'relearn-light', 'relearn-dark', 'zen-light', 'zen-dark', 'neon', 'learn', 'blue', 'green', 'red' ] );
    </script>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="./index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='导航 (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">主页</span><meta itemprop="position" content="1"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable home" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="home">
            <header class="headline">
            </header>
<h1 id="主页">主页</h1>

<hr>
<p>技术收集、随笔、总结。</p>
<hr>
<h2 id="目录">目录</h2>
<hr>
<p>存在以下分类：

<ul class="children children-li children-sort-weight">
	
<li><a href="./1_algorithms/index.html">算法</a><ul>
	
<li><a href="./1_algorithms/1_align/index.html">1 整数对齐</a></li>
<li><a href="./1_algorithms/2_hash/index.html">2 哈希函数</a></li>
<li><a href="./1_algorithms/3_bitwise/index.html">3 位运算快速算法</a></li></ul></li>
<li><a href="./2_struct/index.html">数据结构</a><ul>
	
<li><a href="./2_struct/list/index.html">链表</a></li></ul></li>
<li><a href="./3_compiler/index.html">编译原理</a><ul>
	
<li><a href="./3_compiler/1_lexer/index.html">1 词法分析</a></li>
<li><a href="./3_compiler/2_parser/index.html">2 语法分析</a></li>
<li><a href="./3_compiler/3_analysis/index.html">3 语义分析</a></li>
<li><a href="./3_compiler/4_optimize/index.html">4 中间优化</a></li>
<li><a href="./3_compiler/5_target/index.html">5 目标生成</a></li>
<li><a href="./3_compiler/6_ir/index.html">6 中间代码</a></li>
<li><a href="./3_compiler/7_instruction/index.html">7 指令集</a></li>
<li><a href="./3_compiler/8_langdef/index.html">8 语言定义</a></li>
<li><a href="./3_compiler/9_bcf/index.html">9 字节码文件格式</a></li>
<li><a href="./3_compiler/10_vmimp/index.html">10 虚拟机设计与实现</a></li></ul></li>
<li><a href="./4_graphical/index.html">图形图像</a><ul>
	</ul></li>
<li><a href="./5_os/index.html">操作系统</a><ul>
	</ul></li>
<li><a href="./6_format/index.html">文件数据格式</a><ul>
	
<li><a href="./6_format/1_general/index.html">1 通用格式设计</a></li>
<li><a href="./6_format/2_program/index.html">2 程序格式</a></li>
<li><a href="./6_format/3_color/index.html">3 颜色格式</a></li>
<li><a href="./6_format/4_compress/index.html">4 压缩格式</a></li>
<li><a href="./6_format/5_picture/index.html">5 图片格式</a></li>
<li><a href="./6_format/6_video/index.html">6 视频格式</a></li>
<li><a href="./6_format/7_audio/index.html">7 音频格式</a></li>
<li><a href="./6_format/8_model/index.html">8 模型3D</a></li></ul></li>
</ul></p>
<h2 id="网址收藏">网址收藏</h2>
<h3 id="文件格式相关">文件格式相关</h3>
<ul>
<li><a href="https://www.moon-soft.com/program/FORMAT/" target="_blank">文件格式汇编: https://www.moon-soft.com/program/FORMAT/</a></li>
</ul>
<h3 id="算法相关">算法相关</h3>
<ul>
<li><a href="https://www.cnblogs.com/Kingfans/category/2198205.html" target="_blank">加解密算法: https://www.cnblogs.com/Kingfans/category/2198205.html</a></li>
<li><a href="http://graphics.stanford.edu/~seander/bithacks.html" target="_blank">快速位运算算法: http://graphics.stanford.edu/~seander/bithacks.html</a></li>
</ul>
<h3 id="x86x64指令相关">x86/x64指令相关</h3>
<ul>
<li><a href="https://blog.csdn.net/JimFire/article/details/112652145" target="_blank">x86-64的指令编码入门: https://blog.csdn.net/JimFire/article/details/112652145</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/464774687" target="_blank">x86_64指令编码方式: https://zhuanlan.zhihu.com/p/464774687</a></li>
<li><a href="http://ref.x86asm.net/geek64.html" target="_blank">X86 Opcode and Instruction Reference: http://ref.x86asm.net/geek64.html</a></li>
<li><a href="https://wiki.osdev.org/X86-64_Instruction_Encoding" target="_blank">X86-64_Instruction_Encoding: https://wiki.osdev.org/X86-64_Instruction_Encoding</a></li>
</ul>
<h3 id="游戏引擎相关">游戏引擎相关</h3>
<ul>
<li><a href="https://www.thisisgame.com.cn/tutorial?book=cpp-game-engine-book&amp;lang=zh&amp;md=Introduction.md" target="_blank">游戏引擎 浅入浅出: https://www.thisisgame.com.cn/tutorial?book=cpp-game-engine-book&amp;lang=zh&amp;md=Introduction.md</a></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">主页 的子部分</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="算法">算法</h1>

<h2 id="目录">目录</h2>

<ul class="children children-li children-sort-weight">
	
<li><a href="./1_algorithms/1_align/index.html">1 整数对齐</a><ul>
	</ul></li>
<li><a href="./1_algorithms/2_hash/index.html">2 哈希函数</a><ul>
	
<li><a href="./1_algorithms/2_hash/1_md/index.html">1 消息摘要算法</a><ul>
	
<li><a href="./1_algorithms/2_hash/1_md/1_md2/index.html">1 MD2 算法</a></li>
<li><a href="./1_algorithms/2_hash/1_md/2_md4/index.html">2 MD4 算法</a></li>
<li><a href="./1_algorithms/2_hash/1_md/3_md5/index.html">3 MD5 算法</a></li></ul></li>
<li><a href="./1_algorithms/2_hash/2_sha/index.html">2 签名算法</a><ul>
	
<li><a href="./1_algorithms/2_hash/2_sha/1_sha1/index.html">1 SHA1 算法</a></li>
<li><a href="./1_algorithms/2_hash/2_sha/2_sha2_224/index.html">2 SHA2-224 算法</a></li>
<li><a href="./1_algorithms/2_hash/2_sha/3_sha2_256/index.html">3 SHA2-256 算法</a></li>
<li><a href="./1_algorithms/2_hash/2_sha/4_sha2_384/index.html">4 SHA2-384 算法</a></li>
<li><a href="./1_algorithms/2_hash/2_sha/5_sha2_512/index.html">5 SHA2-512 算法</a></li></ul></li>
<li><a href="./1_algorithms/2_hash/3_crc/index.html">3 CRC 哈希函数</a><ul>
	</ul></li></ul></li>
<li><a href="./1_algorithms/3_bitwise/index.html">3 位运算快速算法</a><ul>
	
<li><a href="./1_algorithms/3_bitwise/1_average/index.html">1 快速平均值</a><ul>
	</ul></li>
<li><a href="./1_algorithms/3_bitwise/2_bitfield/index.html">2 位域值提取</a><ul>
	</ul></li>
<li><a href="./1_algorithms/3_bitwise/3_intmaxmin/index.html">3 使用按位运算计算INT_MAX和INT_MIN</a><ul>
	</ul></li></ul></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">算法 的子部分</h1>
          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/align/index.html">Align</a>
</div>
            </header>
<h1 id="1-整数对齐">1 整数对齐</h1>

<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// 向上大小对齐
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">T</span> <span class="n">alignup</span><span class="p">(</span><span class="n">T</span> <span class="n">num</span><span class="p">,</span> <span class="n">T</span> <span class="n">base</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">num</span> <span class="o">+</span> <span class="n">base</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 向下大小对齐
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">T</span> <span class="n">aligndown</span><span class="p">(</span><span class="n">T</span> <span class="n">num</span><span class="p">,</span> <span class="n">T</span> <span class="n">base</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">num</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span> <span class="p">}</span></span></span></code></pre></div>
            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="2-哈希函数">2 哈希函数</h1>

<h2 id="目录">目录</h2>

<ul class="children children-li children-sort-weight">
	
<li><a href="./1_algorithms/2_hash/1_md/index.html">1 消息摘要算法</a><ul>
	
<li><a href="./1_algorithms/2_hash/1_md/1_md2/index.html">1 MD2 算法</a><ul>
	</ul></li>
<li><a href="./1_algorithms/2_hash/1_md/2_md4/index.html">2 MD4 算法</a><ul>
	</ul></li>
<li><a href="./1_algorithms/2_hash/1_md/3_md5/index.html">3 MD5 算法</a><ul>
	</ul></li></ul></li>
<li><a href="./1_algorithms/2_hash/2_sha/index.html">2 签名算法</a><ul>
	
<li><a href="./1_algorithms/2_hash/2_sha/1_sha1/index.html">1 SHA1 算法</a><ul>
	</ul></li>
<li><a href="./1_algorithms/2_hash/2_sha/2_sha2_224/index.html">2 SHA2-224 算法</a><ul>
	</ul></li>
<li><a href="./1_algorithms/2_hash/2_sha/3_sha2_256/index.html">3 SHA2-256 算法</a><ul>
	</ul></li>
<li><a href="./1_algorithms/2_hash/2_sha/4_sha2_384/index.html">4 SHA2-384 算法</a><ul>
	</ul></li>
<li><a href="./1_algorithms/2_hash/2_sha/5_sha2_512/index.html">5 SHA2-512 算法</a><ul>
	</ul></li></ul></li>
<li><a href="./1_algorithms/2_hash/3_crc/index.html">3 CRC 哈希函数</a><ul>
	</ul></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">2 哈希函数 的子部分</h1>
          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
</div>
            </header>
<h1 id="1-消息摘要算法">1 消息摘要算法</h1>

<h2 id="简介">简介</h2>
<p>MD系列算法是信息摘要三大算法中的一种，全称：Message Digest算法，按照规范版本分为MD2、MD4、MD5三种算法，目前最常用的是MD5版本算法。</p>
<h2 id="md系列家族">MD系列家族</h2>

<ul class="children children-li children-sort-weight">
	
<li><a href="./1_algorithms/2_hash/1_md/1_md2/index.html">1 MD2 算法</a></li>
<li><a href="./1_algorithms/2_hash/1_md/2_md4/index.html">2 MD4 算法</a></li>
<li><a href="./1_algorithms/2_hash/1_md/3_md5/index.html">3 MD5 算法</a></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">1 消息摘要算法 的子部分</h1>
          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
  <a class="tag-link" href="./tags/md/index.html">MD</a>
</div>
            </header>
<h1 id="1-md2-算法">1 MD2 算法</h1>

<p>原文来自：https://www.cnblogs.com/Kingfans/p/16546430.html</p>
<h2 id="1-基本介绍">1 基本介绍</h2>
<p>MD系列算法是信息摘要三大算法中的一种，全称：Message Digest算法，按照规范版本分为MD2、MD4、MD5三种算法，目前最常用的是MD5版本算法。本文介绍MD2算法的实现原理。</p>
<p>1989年，MD2是由著名的非对称算法RSA发明人之一–麻省理工学院教授罗纳德-里维斯特开发的；这个算法首先对信息进行数据补位，使信息的字节长度是16的倍数，再以16位的检验和作为补充信息追加到原信息的末尾。最后根据这个新产生的信息计算出一个128位的散列值，MD2算法由此诞生。</p>
<h2 id="2-实现原理">2 实现原理</h2>
<p>有关MD2 算法详情请参见 RFC 1319 <a href="http://www.ietf.org/rfc/rfc1319.txt" target="_blank">http://www.ietf.org/rfc/rfc1319.txt</a>，RFC 1319 是MD2算法的官方文档，其实现原理共分为5步：</p>
<h3 id="第1步字节填充append-padding-bytes">第1步：字节填充(Append Padding Bytes)</h3>
<p>填充1~16个字节，确保是16字节的倍数，填充规则如下：</p>
<p>假设数据长度为m, 则需要填充16 - (m mod 16)个字节的数据，填充内容为16 - (m mod 16)。</p>
<h3 id="第2步添加校验和append-checksum">第2步：添加校验和(Append Checksum)</h3>
<p>根据下列算法计算校验和，并追加到第1步填充数据的后面。</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>/* Clear checksum. */
For i = 0 to 15 do:
　　Set C[i] to 0.
end /* of loop on i */

Set L to 0.

/* Process each 16-word block. */
For i = 0 to N/16-1 do
　　/* Checksum block i. */
　　For j = 0 to 15 do
　　　　Set c to M[i*16+j].
　　　　Set C[j] to S[c xor L].
　　　　Set L to C[j].
　　end /* of loop on j */
end /* of loop on i */</code></pre></div><h3 id="第3步初始化md-bufferinitialize-md-buffer">第3步：初始化MD Buffer(Initialize MD Buffer)</h3>
<p>最简单不过了，定义一个48字节数组X并初始化为0。</p>
<h3 id="第4步处理消息块process-message-in-16-byte-blocks">第4步：处理消息块(Process Message in 16-Byte Blocks)</h3>
<p>这个是MD2算法最核心的部分了，对第2步组装数据进行分块依次处理。</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>/* Process each 16-word block. */
For i = 0 to N&#39;/16-1 do
　　/* Copy block i into X. */
　　For j = 0 to 15 do
　　　　Set X[16+j] to M[i*16+j].
　　　　Set X[32+j] to (X[16+j] xor X[j]).
　　end /* of loop on j */

　　Set t to 0.

　　/* Do 18 rounds. */
　　For j = 0 to 17 do
　　　　/* Round j. */
　　　　For k = 0 to 47 do
　　　　　　Set t and X[k] to (X[k] xor S[t]).
　　　　end /* of loop on k */
　　　　Set t to (t+j) modulo 256.
　　end /* of loop on j */
end /* of loop on i */</code></pre></div><h3 id="第5步输出output">第5步：输出(Output)</h3>
<p>这一步也非常简单，只需要将计算后的X前16字节进行输出就可以了</p>
<h2 id="3-示例讲解">3 示例讲解</h2>
<p><a href="#image-7e1a6be8833450400e14241b45837caa" class="lightbox-link"><img src="./Hash/MD2_Case.png?width=60pc" alt="MD2案例" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: 60pc;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="image-7e1a6be8833450400e14241b45837caa"><img src="./Hash/MD2_Case.png?width=60pc" alt="MD2案例" class="lightbox-image" loading="lazy"></a></p>
<h2 id="4-代码实现">4 代码实现</h2>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="cp">#define HASH_BLOCK_SIZE     16
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HASH_DIGEST_SIZE    16
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HASH_ROUND_NUM      18
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="cp">#define MD2_CHECKSUM_SIZE   16
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="cp">#define ASSERT_RETURN_INT(x, d) if(!(x)) { return d; }
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">* The S Box of MD2 are generated from Pi digits.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">S</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x2E</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0xC9</span><span class="p">,</span> <span class="mh">0xA2</span><span class="p">,</span> <span class="mh">0xD8</span><span class="p">,</span> <span class="mh">0x7C</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x3D</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0xA1</span><span class="p">,</span> <span class="mh">0xEC</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0xA7</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0xF3</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">,</span> <span class="mh">0xC7</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0xD9</span><span class="p">,</span> <span class="mh">0xBC</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0xCA</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x1E</span><span class="p">,</span> <span class="mh">0x9B</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">,</span> <span class="mh">0xFD</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x6F</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x8A</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0xE5</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0xBE</span><span class="p">,</span> <span class="mh">0x4E</span><span class="p">,</span> <span class="mh">0xC4</span><span class="p">,</span> <span class="mh">0xD6</span><span class="p">,</span> <span class="mh">0xDA</span><span class="p">,</span> <span class="mh">0x9E</span><span class="p">,</span> <span class="mh">0xDE</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0xA0</span><span class="p">,</span> <span class="mh">0xFB</span><span class="p">,</span> <span class="mh">0xF5</span><span class="p">,</span> <span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0xBB</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">,</span> <span class="mh">0xEE</span><span class="p">,</span> <span class="mh">0x7A</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0xA9</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xB2</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xC2</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x5F</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">,</span> <span class="mh">0x5D</span><span class="p">,</span> <span class="mh">0x9A</span><span class="p">,</span> <span class="mh">0x5A</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x3E</span><span class="p">,</span> <span class="mh">0xCC</span><span class="p">,</span> <span class="mh">0xE7</span><span class="p">,</span> <span class="mh">0xBF</span><span class="p">,</span> <span class="mh">0xF7</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0xB3</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xA5</span><span class="p">,</span> <span class="mh">0xB5</span><span class="p">,</span> <span class="mh">0xD1</span><span class="p">,</span> <span class="mh">0xD7</span><span class="p">,</span> <span class="mh">0x5E</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x2A</span><span class="p">,</span> <span class="mh">0xAC</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0xAA</span><span class="p">,</span> <span class="mh">0xC6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x4F</span><span class="p">,</span> <span class="mh">0xB8</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0xA4</span><span class="p">,</span> <span class="mh">0x7D</span><span class="p">,</span> <span class="mh">0xB6</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0xFC</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0xE2</span><span class="p">,</span> <span class="mh">0x9C</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0xF1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x9D</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x5B</span><span class="p">,</span> <span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0xE6</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">,</span> <span class="mh">0xA8</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x1B</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xAD</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0xB0</span><span class="p">,</span> <span class="mh">0xB9</span><span class="p">,</span> <span class="mh">0xF6</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x7E</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0xA3</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xDD</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0xAF</span><span class="p">,</span> <span class="mh">0x3A</span><span class="p">,</span> <span class="mh">0xC3</span><span class="p">,</span> <span class="mh">0x5C</span><span class="p">,</span> <span class="mh">0xF9</span><span class="p">,</span> <span class="mh">0xCE</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0xC5</span><span class="p">,</span> <span class="mh">0xEA</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x2C</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">,</span> <span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xD3</span><span class="p">,</span> <span class="mh">0xDF</span><span class="p">,</span> <span class="mh">0xCD</span><span class="p">,</span> <span class="mh">0xF4</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x4D</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x6A</span><span class="p">,</span> <span class="mh">0xDC</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0xC8</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span> <span class="mh">0xC1</span><span class="p">,</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0xFA</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0xE1</span><span class="p">,</span> <span class="mh">0x7B</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0xBD</span><span class="p">,</span> <span class="mh">0xB1</span><span class="p">,</span> <span class="mh">0x4A</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0xE3</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0xE8</span><span class="p">,</span> <span class="mh">0x6D</span><span class="p">,</span> <span class="mh">0xE9</span><span class="p">,</span> <span class="mh">0xCB</span><span class="p">,</span> <span class="mh">0xD5</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">,</span> <span class="mh">0x3B</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0xF2</span><span class="p">,</span> <span class="mh">0xEF</span><span class="p">,</span> <span class="mh">0xB7</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0xD0</span><span class="p">,</span> <span class="mh">0xE4</span><span class="p">,</span> <span class="mh">0xA6</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0xF8</span><span class="p">,</span> <span class="mh">0xEB</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x4B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0xB4</span><span class="p">,</span> <span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0xED</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="mh">0xDB</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x8D</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x9F</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x14</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">md2</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">in</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">inlen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ASSERT_RETURN_INT</span><span class="p">(</span><span class="n">out</span> <span class="o">&amp;&amp;</span> <span class="n">in</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">inlen</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 1: 字节填充(Append Padding Bytes)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 假设数据长度为m, 则需要填充16 - (m mod 16)个字节的数据，填充内容为16 - (m mod 16).
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">iLen</span> <span class="o">=</span> <span class="p">(</span><span class="n">inlen</span> <span class="o">/</span> <span class="n">HASH_BLOCK_SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">M</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">iLen</span> <span class="o">+</span> <span class="n">MD2_CHECKSUM_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">in</span><span class="p">,</span> <span class="n">inlen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">inlen</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iLen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">iLen</span> <span class="o">-</span> <span class="n">inlen</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 2: 添加校验和(Append Checksum)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">C</span><span class="p">[</span><span class="n">MD2_CHECKSUM_SIZE</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">memset</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MD2_CHECKSUM_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iLen</span> <span class="o">/</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">j</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">^</span> <span class="n">S</span><span class="p">[</span><span class="n">c</span> <span class="o">^</span> <span class="n">L</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="n">L</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">iLen</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 3: 初始化MD Buffer(Initialize MD Buffer):
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">X</span><span class="p">[</span><span class="mi">48</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">memset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">48</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 4: 处理消息块(Process Message in 16-Byte Blocks)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">iLen</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Copy block i into X. */</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">X</span><span class="p">[</span><span class="mi">16</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">j</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="n">X</span><span class="p">[</span><span class="mi">32</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">16</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">^</span> <span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Do 18 rounds. */</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">HASH_ROUND_NUM</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/* Round j */</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">48</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">t</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">^</span> <span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">HASH_DIGEST_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">free</span><span class="p">(</span><span class="n">M</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">digest</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="n">md2</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="s">&#34;Hello World!&#34;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;Hello World!&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
  <a class="tag-link" href="./tags/md/index.html">MD</a>
</div>
            </header>
<h1 id="2-md4-算法">2 MD4 算法</h1>

<p>原文来自：https://www.cnblogs.com/Kingfans/p/16552308.html</p>
<h2 id="一基本介绍">一、基本介绍</h2>
<p>MD系列算法是信息摘要三大算法中的一种，全称：Message Digest算法，按照规范版本分为MD2、MD4、MD5三种算法，目前最常用的是MD5版本算法。本文介绍MD4算法的实现原理。</p>
<p>1990 年，罗纳德·李维斯特教授开发出较之 MD2 算法有着更高安全性的 MD4 算法。在这个算法中，我们仍需对信息进行数据补位。不同的是，这种补位使其信息的字节长度加上 448 个字节后能成为 512 的倍数（信息字节长度 mod 512 = 448）。此外，关于 MD4 算法的处理与 MD2 算法又有很大差别。但最终仍旧是会获得一个 128 位的散列值。MD4 算法对后续消息摘要算法起到了推动作用，许多比较有名的消息摘要算法都是在 MD4 算法的基础上发展而来的，如 MD5、SHA-1、RIPE-MD 和 HAVAL 算法等。</p>
<h2 id="二实现原理">二、实现原理</h2>
<p>有关 MD4 算法详情请参见 RFC 1320 <a href="http://www.ietf.org/rfc/rfc1320.txt" target="_blank">http://www.ietf.org/rfc/rfc1320.txt</a>，RFC 1320 是MD4算法的官方文档，其实现原理共分为5步：</p>
<h3 id="第1步字节填充append-padding-bytes">第1步：字节填充(Append Padding Bytes)</h3>
<p>数据先补上1个1比特，再补上k个0比特，使得补位后的数据比特数(n+1+k)满足(n+1+k) mod 512 = 448，k取最小正整数。</p>
<h3 id="第2步追加长度信息append-length">第2步：追加长度信息(Append Length)</h3>
<p>数据比特位的数据长度追加到最后8字节中。</p>
<h3 id="第3步初始化md-bufferinitialize-md-buffer">第3步：初始化MD Buffer(Initialize MD Buffer)</h3>
<p>这一步最简单了，定义ABCD四个4字节数组，分别赋初值即可。</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>1
2
3
4
uint32_t A = 0x67452301;    // [ 0x01, 0x23, 0x45, 0x67 ]
uint32_t B = 0xEFCDAB89;    // [ 0x89, 0xAB, 0xCD, 0xEF ]
uint32_t C = 0x98BADCFE;    // [ 0xFE, 0xDC, 0xBA, 0x98 ]
uint32_t D = 0x10325476;    // [ 0x76, 0x54, 0x32, 0x10 ]   </code></pre></div><h3 id="第4步处理消息块process-message-in-16-byte-blocks">第4步：处理消息块(Process Message in 16-Byte Blocks)</h3>
<p>这个是MD4算法最核心的部分了，对第2步组装数据进行分块依次处理。</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>Process each 16-word block. */
For i = 0 to N/16-1 do
 
  /* Copy block i into X. */
  For j = 0 to 15 do
    Set X[j] to M[i*16+j].
  end /* of loop on j */
 
  /* Save A as AA, B as BB, C as CC, and D as DD. */
  AA = A
  BB = B
  CC = C
  DD = D
 
  /* Round 1. */
  /* Let [abcd k s] denote the operation
       a = (a + F(b,c,d) + X[k]) &lt;&lt;&lt; s. */
  /* Do the following 16 operations. */
  [ABCD  0  3]  [DABC  1  7]  [CDAB  2 11]  [BCDA  3 19]
  [ABCD  4  3]  [DABC  5  7]  [CDAB  6 11]  [BCDA  7 19]
  [ABCD  8  3]  [DABC  9  7]  [CDAB 10 11]  [BCDA 11 19]
  [ABCD 12  3]  [DABC 13  7]  [CDAB 14 11]  [BCDA 15 19]
 
  /* Round 2. */
  /* Let [abcd k s] denote the operation
       a = (a + G(b,c,d) + X[k] + 5A827999) &lt;&lt;&lt; s. */
  /* Do the following 16 operations. */
  [ABCD  0  3]  [DABC  4  5]  [CDAB  8  9]  [BCDA 12 13]
  [ABCD  1  3]  [DABC  5  5]  [CDAB  9  9]  [BCDA 13 13]
  [ABCD  2  3]  [DABC  6  5]  [CDAB 10  9]  [BCDA 14 13]
  [ABCD  3  3]  [DABC  7  5]  [CDAB 11  9]  [BCDA 15 13]
 
  /* Round 3. */
  /* Let [abcd k s] denote the operation
       a = (a + H(b,c,d) + X[k] + 6ED9EBA1) &lt;&lt;&lt; s. */
  /* Do the following 16 operations. */
  [ABCD  0  3]  [DABC  8  9]  [CDAB  4 11]  [BCDA 12 15]
  [ABCD  2  3]  [DABC 10  9]  [CDAB  6 11]  [BCDA 14 15]
  [ABCD  1  3]  [DABC  9  9]  [CDAB  5 11]  [BCDA 13 15]
  [ABCD  3  3]  [DABC 11  9]  [CDAB  7 11]  [BCDA 15 15]
 
  /* Then perform the following additions. (That is, increment each
     of the four registers by the value it had before this block
     was started.) */
  A = A + AA
  B = B + BB
  C = C + CC
  D = D + DD
 
end /* of loop on i */</code></pre></div><h3 id="第5步输出output">第5步：输出(Output)</h3>
<p>这一步也非常简单，只需要将计算后的A、B、C、D进行拼接输出即可。</p>
<h2 id="三示例讲解">三、示例讲解</h2>
<p><a href="#image-ed92f6f067ef4d87bf6452515d9b85ee" class="lightbox-link"><img src="./Hash/MD4_Case.png?width=60pc" alt="MD4案例" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: 60pc;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="image-ed92f6f067ef4d87bf6452515d9b85ee"><img src="./Hash/MD4_Case.png?width=60pc" alt="MD4案例" class="lightbox-image" loading="lazy"></a></p>
<h2 id="代码实现">代码实现</h2>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="cp">#define HASH_BLOCK_SIZE         64  </span><span class="cm">/* 512 bits = 64 bytes */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HASH_LEN_SIZE           8   </span><span class="cm">/* 64 bits =  8 bytes */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HASH_LEN_OFFSET         56  </span><span class="cm">/* 64 bytes - 8 bytes */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HASH_DIGEST_SIZE        16  </span><span class="cm">/* 128 bits = 16 bytes */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HASH_ROUND_NUM          64
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span>       <span class="kt">uint8_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span>  <span class="kt">uint16_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">int</span>        <span class="kt">uint32_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span>  <span class="kt">uint64_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">F</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">X</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Y</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">X</span> <span class="o">&amp;</span> <span class="n">Y</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="o">~</span><span class="n">X</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Z</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">G</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">X</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Y</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">X</span> <span class="o">&amp;</span> <span class="n">Y</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">X</span> <span class="o">&amp;</span> <span class="n">Z</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">Y</span> <span class="o">&amp;</span> <span class="n">Z</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">H</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">X</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Y</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">X</span> <span class="o">^</span> <span class="n">Y</span> <span class="o">^</span> <span class="n">Z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="cm">/* 循环向左移动offset个单位 */</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">MoveLeft</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">X</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">X</span> <span class="o">&lt;&lt;</span> <span class="n">offset</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">X</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">offset</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">Round1</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">A</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">B</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">C</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">D</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">M</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">MoveLeft</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">F</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span> <span class="o">+</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">Round2</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">A</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">B</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">C</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">D</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">M</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">MoveLeft</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">G</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mh">0x5A827999</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">Round3</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">A</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">B</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">C</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">D</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">M</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">MoveLeft</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">H</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mh">0x6ED9EBA1</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="cp">#define ASSERT_RETURN_INT(x, d) if(!(x)) { return d; }
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">md4</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">in</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">inlen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ASSERT_RETURN_INT</span><span class="p">(</span><span class="n">out</span> <span class="o">&amp;&amp;</span> <span class="n">in</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">inlen</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 1: 字节填充(Append Padding Bytes)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 数据先补上1个1比特，再补上k个0比特，使得补位后的数据比特数(n+1+k)满足(n+1+k) mod 512 = 448，k取最小正整数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">iX</span> <span class="o">=</span> <span class="n">inlen</span> <span class="o">/</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">iY</span> <span class="o">=</span> <span class="n">inlen</span> <span class="o">%</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">iX</span> <span class="o">=</span> <span class="p">(</span><span class="n">iY</span> <span class="o">&lt;</span> <span class="n">HASH_LEN_OFFSET</span><span class="p">)</span> <span class="o">?</span> <span class="nl">iX</span> <span class="p">:</span> <span class="p">(</span><span class="n">iX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">iLen</span> <span class="o">=</span> <span class="p">(</span><span class="n">iX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">M</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">iLen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">in</span><span class="p">,</span> <span class="n">inlen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 先补上1个1比特+7个0比特
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">M</span><span class="p">[</span><span class="n">inlen</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 再补上(k-7)个0比特
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">inlen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">iX</span> <span class="o">*</span> <span class="n">HASH_BLOCK_SIZE</span> <span class="o">+</span> <span class="n">HASH_LEN_OFFSET</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 2: 追加长度信息(Append Length)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">pLen</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="o">*</span><span class="p">)(</span><span class="n">M</span> <span class="o">+</span> <span class="p">(</span><span class="n">iX</span> <span class="o">*</span> <span class="n">HASH_BLOCK_SIZE</span> <span class="o">+</span> <span class="n">HASH_LEN_OFFSET</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">pLen</span> <span class="o">=</span> <span class="n">inlen</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// Step 3. 初始化MD Buffer(Initialize MD Buffer)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">A</span> <span class="o">=</span> <span class="mh">0x67452301</span><span class="p">;</span>    <span class="c1">// [ 0x01, 0x23, 0x45, 0x67 ]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">B</span> <span class="o">=</span> <span class="mh">0xEFCDAB89</span><span class="p">;</span>    <span class="c1">// [ 0x89, 0xAB, 0xCD, 0xEF ]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">C</span> <span class="o">=</span> <span class="mh">0x98BADCFE</span><span class="p">;</span>    <span class="c1">// [ 0xFE, 0xDC, 0xBA, 0x98 ]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">D</span> <span class="o">=</span> <span class="mh">0x10325476</span><span class="p">;</span>    <span class="c1">// [ 0x76, 0x54, 0x32, 0x10 ]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> 
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">X</span><span class="p">[</span><span class="n">HASH_BLOCK_SIZE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 4: 处理消息块(Process Message in 64-Byte Blocks)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iLen</span> <span class="o">/</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Copy block i into X. */</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">uint32_t</span><span class="o">*</span> <span class="n">temp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">M</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">HASH_BLOCK_SIZE</span> <span class="o">+</span> <span class="n">j</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="o">/</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Save A as AA, B as BB, C as CC, and D as DD. */</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint32_t</span> <span class="n">AA</span> <span class="o">=</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint32_t</span> <span class="n">BB</span> <span class="o">=</span> <span class="n">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint32_t</span> <span class="n">CC</span> <span class="o">=</span> <span class="n">C</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint32_t</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">D</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Round 1. */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Let [abcd k s] denote the operation
</span></span></span><span class="line"><span class="cl"><span class="cm">        a = (a + F(b,c,d) + X[k]) &lt;&lt;&lt; s. */</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Do the following 16 operations.
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  0  3][DABC  1  7][CDAB  2 11][BCDA  3 19]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  4  3][DABC  5  7][CDAB  6 11][BCDA  7 19]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  8  3][DABC  9  7][CDAB 10 11][BCDA 11 19]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD 12  3][DABC 13  7][CDAB 14 11][BCDA 15 19]
</span></span></span><span class="line"><span class="cl"><span class="cm">        */</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">7</span><span class="p">);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">11</span><span class="p">);</span>  <span class="n">B</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">19</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">7</span><span class="p">);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="mi">11</span><span class="p">);</span>  <span class="n">B</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="mi">19</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="mi">7</span><span class="p">);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="mi">11</span><span class="p">);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="mi">19</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="mi">7</span><span class="p">);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="mi">11</span><span class="p">);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="mi">19</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Round 2. */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Let [abcd k s] denote the operation
</span></span></span><span class="line"><span class="cl"><span class="cm">        a = (a + G(b,c,d) + X[k] + 5A827999) &lt;&lt;&lt; s. */</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Do the following 16 operations.
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  0  3][DABC  4  5][CDAB  8  9][BCDA 12 13]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  1  3][DABC  5  5][CDAB  9  9][BCDA 13 13]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  2  3][DABC  6  5][CDAB 10  9][BCDA 14 13]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  3  3][DABC  7  5][CDAB 11  9][BCDA 15 13]
</span></span></span><span class="line"><span class="cl"><span class="cm">        */</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">5</span><span class="p">);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span>  <span class="n">B</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="mi">13</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">5</span><span class="p">);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span>  <span class="n">B</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="mi">13</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="mi">5</span><span class="p">);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="mi">13</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="mi">5</span><span class="p">);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="mi">13</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Round 3. */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Let [abcd k s] denote the operation
</span></span></span><span class="line"><span class="cl"><span class="cm">        a = (a + H(b,c,d) + X[k] + 6ED9EBA1) &lt;&lt;&lt; s. */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Do the following 16 operations.
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  0  3][DABC  8  9][CDAB  4 11][BCDA 12 15]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  2  3][DABC 10  9][CDAB  6 11][BCDA 14 15]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  1  3][DABC  9  9][CDAB  5 11][BCDA 13 15]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  3  3][DABC 11  9][CDAB  7 11][BCDA 15 15]
</span></span></span><span class="line"><span class="cl"><span class="cm">        */</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">11</span><span class="p">);</span>  <span class="n">B</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="mi">15</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="mi">11</span><span class="p">);</span>  <span class="n">B</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="mi">15</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">11</span><span class="p">);</span>  <span class="n">B</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="mi">15</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="mi">11</span><span class="p">);</span>  <span class="n">B</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="mi">15</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Then perform the following additions. (That is, increment each
</span></span></span><span class="line"><span class="cl"><span class="cm">        of the four registers by the value it had before this block
</span></span></span><span class="line"><span class="cl"><span class="cm">        was started.) */</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">AA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">B</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">BB</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">C</span> <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">CC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">D</span> <span class="o">=</span> <span class="n">D</span> <span class="o">+</span> <span class="n">DD</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 5: 输出ABCD
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">memcpy</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="mi">12</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">D</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">free</span><span class="p">(</span><span class="n">M</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">digest</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="n">md4</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="s">&#34;Hello World!&#34;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;Hello World!&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
  <a class="tag-link" href="./tags/md/index.html">MD</a>
</div>
            </header>
<h1 id="3-md5-算法">3 MD5 算法</h1>

<p>原文来自：https://www.cnblogs.com/Kingfans/p/16554047.html</p>
<h2 id="一基本介绍">一、基本介绍</h2>
<p>MD系列算法是信息摘要三大算法中的一种，全称：Message Digest算法，按照规范版本分为MD2、MD4、MD5三种算法，目前最常用的是MD5版本算法。本文介绍MD5算法的实现原理。</p>
<p>1991年，继 MD4 算法后，罗纳德·李维斯特教授开发了 MD5 算法，将 MD 算法推向成熟。MD5 算法经 MD2、MD3 和 MD4 算法发展而来，算法复杂程度和安全强度大大提高。但不管是 MD2、MD4 还是 MD5 算法，其算法的最终结果均是产生一个 128 位的消息摘要，这也是 MD 系列算法的特点。MD5 算法执行效率略次于 MD4 算法，但在安全性方面，MD5 算法更胜一筹。随着计算机技术的发展和计算水平的不断提高，MD5 算法暴露出来的漏洞也越来越多。1996 年后被证实存在弱点，可以被加以破解，对于需要高度安全性的数据，专家一般建议改用其他算法，如 SHA-2。2004 年，证实 MD5 算法无法防止碰撞（collision），因此不适用于安全性认证，如 SSL 公开密钥认证或是数字签名等用途。</p>
<h2 id="二实现原理">二、实现原理</h2>
<p>有关 MD5 算法详情请参见 RFC 1321 <a href="http://www.ietf.org/rfc/rfc1321.txt" target="_blank">http://www.ietf.org/rfc/rfc1321.txt</a>，RFC 1321 是MD5算法的官方文档，其实现原理共分为5步：</p>
<h3 id="第1步字节填充append-padding-bytes">第1步：字节填充(Append Padding Bytes)</h3>
<p>数据先补上1个1比特，再补上k个0比特，使得补位后的数据比特数(n+1+k)满足(n+1+k) mod 512 = 448，k取最小正整数。</p>
<h3 id="第2步追加长度信息append-length">第2步：追加长度信息(Append Length)</h3>
<p>数据比特位的数据长度追加到最后8字节中。</p>
<h3 id="第3步初始化md-bufferinitialize-md-buffer">第3步：初始化MD Buffer(Initialize MD Buffer)</h3>
<p>这一步最简单了，定义ABCD四个4字节数组，分别赋初值即可。</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>uint32_t A = 0x67452301;    // [ 0x01, 0x23, 0x45, 0x67 ]
uint32_t B = 0xEFCDAB89;    // [ 0x89, 0xAB, 0xCD, 0xEF ]
uint32_t C = 0x98BADCFE;    // [ 0xFE, 0xDC, 0xBA, 0x98 ]
uint32_t D = 0x10325476;    // [ 0x76, 0x54, 0x32, 0x10 ]</code></pre></div><p>以上操作与md4完全一致。</p>
<h3 id="第4步处理消息块process-message-in-16-byte-blocks">第4步：处理消息块(Process Message in 16-Byte Blocks)</h3>
<p>这个是MD5算法最核心的部分了，对第2步组装数据进行分块依次处理。</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>/* Process each 16-word block. */
For i = 0 to N/16-1 do
 
  /* Copy block i into X. */
  For j = 0 to 15 do
    Set X[j] to M[i*16+j].
  end /* of loop on j */
 
  /* Save A as AA, B as BB, C as CC, and D as DD. */
  AA = A
  BB = B
  CC = C
  DD = D
 
  /* Round 1. */
  /* Let [abcd k s i] denote the operation
       a = b + ((a + F(b,c,d) + X[k] + T[i]) &lt;&lt;&lt; s). */
  /* Do the following 16 operations. */
  [ABCD  0  7  1]  [DABC  1 12  2]  [CDAB  2 17  3]  [BCDA  3 22  4]
  [ABCD  4  7  5]  [DABC  5 12  6]  [CDAB  6 17  7]  [BCDA  7 22  8]
  [ABCD  8  7  9]  [DABC  9 12 10]  [CDAB 10 17 11]  [BCDA 11 22 12]
  [ABCD 12  7 13]  [DABC 13 12 14]  [CDAB 14 17 15]  [BCDA 15 22 16]
 
  /* Round 2. */
  /* Let [abcd k s i] denote the operation
       a = b + ((a + G(b,c,d) + X[k] + T[i]) &lt;&lt;&lt; s). */
  /* Do the following 16 operations. */
  [ABCD  1  5 17]  [DABC  6  9 18]  [CDAB 11 14 19]  [BCDA  0 20 20]
  [ABCD  5  5 21]  [DABC 10  9 22]  [CDAB 15 14 23]  [BCDA  4 20 24]
  [ABCD  9  5 25]  [DABC 14  9 26]  [CDAB  3 14 27]  [BCDA  8 20 28]
  [ABCD 13  5 29]  [DABC  2  9 30]  [CDAB  7 14 31]  [BCDA 12 20 32]
 
  /* Round 3. */
  /* Let [abcd k s t] denote the operation
       a = b + ((a + H(b,c,d) + X[k] + T[i]) &lt;&lt;&lt; s). */
  /* Do the following 16 operations. */
  [ABCD  5  4 33]  [DABC  8 11 34]  [CDAB 11 16 35]  [BCDA 14 23 36]
  [ABCD  1  4 37]  [DABC  4 11 38]  [CDAB  7 16 39]  [BCDA 10 23 40]
  [ABCD 13  4 41]  [DABC  0 11 42]  [CDAB  3 16 43]  [BCDA  6 23 44]
  [ABCD  9  4 45]  [DABC 12 11 46]  [CDAB 15 16 47]  [BCDA  2 23 48]
 
  /* Round 4. */
  /* Let [abcd k s t] denote the operation
       a = b + ((a + I(b,c,d) + X[k] + T[i]) &lt;&lt;&lt; s). */
  /* Do the following 16 operations. */
  [ABCD  0  6 49]  [DABC  7 10 50]  [CDAB 14 15 51]  [BCDA  5 21 52]
  [ABCD 12  6 53]  [DABC  3 10 54]  [CDAB 10 15 55]  [BCDA  1 21 56]
  [ABCD  8  6 57]  [DABC 15 10 58]  [CDAB  6 15 59]  [BCDA 13 21 60]
  [ABCD  4  6 61]  [DABC 11 10 62]  [CDAB  2 15 63]  [BCDA  9 21 64]
 
  /* Then perform the following additions. (That is increment each
     of the four registers by the value it had before this block
     was started.) */
  A = A + AA
  B = B + BB
  C = C + CC
  D = D + DD
 
end /* of loop on i */</code></pre></div><h3 id="第5步输出output">第5步：输出(Output)</h3>
<p>这一步也非常简单，只需要将计算后的A、B、C、D进行拼接输出即可。</p>
<h2 id="三示例讲解">三、示例讲解</h2>
<p><a href="#image-6253bc52ceacabd20a01f195edef969e" class="lightbox-link"><img src="./Hash/MD5_Case.png?width=60pc" alt="MD5_Case" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: 60pc;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="image-6253bc52ceacabd20a01f195edef969e"><img src="./Hash/MD5_Case.png?width=60pc" alt="MD5_Case" class="lightbox-image" loading="lazy"></a></p>
<h2 id="四代码实现">四、代码实现</h2>
<p>以下为C/C++代码实现：</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="cp">#define HASH_BLOCK_SIZE         64  </span><span class="cm">/* 512 bits = 64 bytes */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HASH_LEN_SIZE           8   </span><span class="cm">/* 64 bits =  8 bytes */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HASH_LEN_OFFSET         56  </span><span class="cm">/* 64 bytes - 8 bytes */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HASH_DIGEST_SIZE        16  </span><span class="cm">/* 128 bits = 16 bytes */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span>       <span class="kt">uint8_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span>  <span class="kt">uint16_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">int</span>        <span class="kt">uint32_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span>  <span class="kt">uint64_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="cm">/* T table */</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="n">T</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* Round 1 */</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0xD76AA478</span><span class="p">,</span> <span class="mh">0xE8C7B756</span><span class="p">,</span> <span class="mh">0x242070DB</span><span class="p">,</span> <span class="mh">0xC1BDCEEE</span><span class="p">,</span> <span class="mh">0xF57C0FAF</span><span class="p">,</span> <span class="mh">0x4787C62A</span><span class="p">,</span> <span class="mh">0xA8304613</span><span class="p">,</span> <span class="mh">0xFD469501</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x698098D8</span><span class="p">,</span> <span class="mh">0x8B44F7AF</span><span class="p">,</span> <span class="mh">0xFFFF5BB1</span><span class="p">,</span> <span class="mh">0x895CD7BE</span><span class="p">,</span> <span class="mh">0x6B901122</span><span class="p">,</span> <span class="mh">0xFD987193</span><span class="p">,</span> <span class="mh">0xA679438E</span><span class="p">,</span> <span class="mh">0x49B40821</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* ROUND 2 */</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0xF61E2562</span><span class="p">,</span> <span class="mh">0xC040B340</span><span class="p">,</span> <span class="mh">0x265E5A51</span><span class="p">,</span> <span class="mh">0xE9B6C7AA</span><span class="p">,</span> <span class="mh">0xD62F105D</span><span class="p">,</span> <span class="mh">0x02441453</span><span class="p">,</span> <span class="mh">0xD8A1E681</span><span class="p">,</span> <span class="mh">0xE7D3FBC8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x21E1CDE6</span><span class="p">,</span> <span class="mh">0xC33707D6</span><span class="p">,</span> <span class="mh">0xF4D50D87</span><span class="p">,</span> <span class="mh">0x455A14ED</span><span class="p">,</span> <span class="mh">0xA9E3E905</span><span class="p">,</span> <span class="mh">0xFCEFA3F8</span><span class="p">,</span> <span class="mh">0x676F02D9</span><span class="p">,</span> <span class="mh">0x8D2A4C8A</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* ROUND 3 */</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0xFFFA3942</span><span class="p">,</span> <span class="mh">0x8771F681</span><span class="p">,</span> <span class="mh">0x6D9D6122</span><span class="p">,</span> <span class="mh">0xFDE5380C</span><span class="p">,</span> <span class="mh">0xA4BEEA44</span><span class="p">,</span> <span class="mh">0x4BDECFA9</span><span class="p">,</span> <span class="mh">0xF6BB4B60</span><span class="p">,</span> <span class="mh">0xBEBFBC70</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x289B7EC6</span><span class="p">,</span> <span class="mh">0xEAA127FA</span><span class="p">,</span> <span class="mh">0xD4EF3085</span><span class="p">,</span> <span class="mh">0x04881D05</span><span class="p">,</span> <span class="mh">0xD9D4D039</span><span class="p">,</span> <span class="mh">0xE6DB99E5</span><span class="p">,</span> <span class="mh">0x1FA27CF8</span><span class="p">,</span> <span class="mh">0xC4AC5665</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* ROUND 4 */</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0xF4292244</span><span class="p">,</span> <span class="mh">0x432AFF97</span><span class="p">,</span> <span class="mh">0xAB9423A7</span><span class="p">,</span> <span class="mh">0xFC93A039</span><span class="p">,</span> <span class="mh">0x655B59C3</span><span class="p">,</span> <span class="mh">0x8F0CCC92</span><span class="p">,</span> <span class="mh">0xFFEFF47D</span><span class="p">,</span> <span class="mh">0x85845DD1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x6FA87E4F</span><span class="p">,</span> <span class="mh">0xFE2CE6E0</span><span class="p">,</span> <span class="mh">0xA3014314</span><span class="p">,</span> <span class="mh">0x4E0811A1</span><span class="p">,</span> <span class="mh">0xF7537E82</span><span class="p">,</span> <span class="mh">0xBD3AF235</span><span class="p">,</span> <span class="mh">0x2AD7D2BB</span><span class="p">,</span> <span class="mh">0xEB86D391</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">F</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">X</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Y</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">X</span> <span class="o">&amp;</span> <span class="n">Y</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="o">~</span><span class="n">X</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Z</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">G</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">X</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Y</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">X</span> <span class="o">&amp;</span> <span class="n">Z</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">Y</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">Z</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">H</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">X</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Y</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">X</span> <span class="o">^</span> <span class="n">Y</span> <span class="o">^</span> <span class="n">Z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">I</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">X</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Y</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Y</span> <span class="o">^</span> <span class="p">(</span> <span class="n">X</span> <span class="o">|</span> <span class="p">(</span><span class="o">~</span><span class="n">Z</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="cm">/* 循环向左移动offset个比特位 */</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">MoveLeft</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">X</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">&lt;&lt;</span> <span class="n">offset</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">X</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">offset</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">Round1</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">A</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">B</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">C</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">D</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">M</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">N</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">T</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">B</span> <span class="o">+</span> <span class="n">MoveLeft</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">F</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">Round2</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">A</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">B</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">C</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">D</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">M</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">N</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">T</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">B</span> <span class="o">+</span> <span class="n">MoveLeft</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">G</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">Round3</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">A</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">B</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">C</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">D</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">M</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">N</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">T</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">B</span> <span class="o">+</span> <span class="n">MoveLeft</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">H</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">Round4</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">A</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">B</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">C</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">D</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">M</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">N</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">T</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">B</span> <span class="o">+</span> <span class="n">MoveLeft</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">I</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="cp">#define ASSERT_RETURN_INT(x, d) if(!(x)) { return d; }
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">md5</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">in</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">inlen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ASSERT_RETURN_INT</span><span class="p">(</span><span class="n">out</span> <span class="o">&amp;&amp;</span> <span class="n">in</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">inlen</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 1: 字节填充(Append Padding Bytes)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 数据先补上1个1比特，再补上k个0比特，使得补位后的数据比特数(n+1+k)满足(n+1+k) mod 512 = 448，k取最小正整数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">iX</span> <span class="o">=</span> <span class="n">inlen</span> <span class="o">/</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">iY</span> <span class="o">=</span> <span class="n">inlen</span> <span class="o">%</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">iX</span> <span class="o">=</span> <span class="p">(</span><span class="n">iY</span> <span class="o">&lt;</span> <span class="n">HASH_LEN_OFFSET</span><span class="p">)</span> <span class="o">?</span> <span class="nl">iX</span> <span class="p">:</span> <span class="p">(</span><span class="n">iX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">iLen</span> <span class="o">=</span> <span class="p">(</span><span class="n">iX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">M</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">iLen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">in</span><span class="p">,</span> <span class="n">inlen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 先补上1个1比特+7个0比特
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">M</span><span class="p">[</span><span class="n">inlen</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 再补上(k-7)个0比特
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">inlen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">iX</span> <span class="o">*</span> <span class="n">HASH_BLOCK_SIZE</span> <span class="o">+</span> <span class="n">HASH_LEN_OFFSET</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 2: 追加长度信息(Append Length)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">pLen</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="o">*</span><span class="p">)(</span><span class="n">M</span> <span class="o">+</span> <span class="p">(</span><span class="n">iX</span> <span class="o">*</span> <span class="n">HASH_BLOCK_SIZE</span> <span class="o">+</span> <span class="n">HASH_LEN_OFFSET</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">pLen</span> <span class="o">=</span> <span class="n">inlen</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// Step 3. 初始化MD Buffer(Initialize MD Buffer)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">A</span> <span class="o">=</span> <span class="mh">0x67452301</span><span class="p">;</span>    <span class="c1">// 0x01, 0x23, 0x45, 0x67
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">B</span> <span class="o">=</span> <span class="mh">0xEFCDAB89</span><span class="p">;</span>    <span class="c1">// 0x89, 0xAB, 0xCD, 0xEF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">C</span> <span class="o">=</span> <span class="mh">0x98BADCFE</span><span class="p">;</span>    <span class="c1">// 0xFE, 0xDC, 0xBA, 0x98
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">D</span> <span class="o">=</span> <span class="mh">0x10325476</span><span class="p">;</span>    <span class="c1">// 0x76, 0x54, 0x32, 0x10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> 
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">X</span><span class="p">[</span><span class="n">HASH_BLOCK_SIZE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 4: 处理消息块(Process Message in 64-Byte Blocks)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iLen</span> <span class="o">/</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Copy block i into X. */</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">HASH_BLOCK_SIZE</span><span class="p">;</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">uint32_t</span><span class="o">*</span> <span class="n">temp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">M</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">HASH_BLOCK_SIZE</span> <span class="o">+</span> <span class="n">j</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="n">X</span><span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Save A as AA, B as BB, C as CC, and D as DD. */</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint32_t</span> <span class="n">AA</span> <span class="o">=</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint32_t</span> <span class="n">BB</span> <span class="o">=</span> <span class="n">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint32_t</span> <span class="n">CC</span> <span class="o">=</span> <span class="n">C</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint32_t</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">D</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Round 1. */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Let [abcd k s i] denote the operation
</span></span></span><span class="line"><span class="cl"><span class="cm">            a = b + ((a + F(b,c,d) + X[k] + T[i]) &lt;&lt;&lt; s). */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Do the following 16 operations.
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  0  7  1][DABC  1 12  2][CDAB  2 17  3][BCDA  3 22  4]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  4  7  5][DABC  5 12  6][CDAB  6 17  7][BCDA  7 22  8]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  8  7  9][DABC  9 12 10][CDAB 10 17 11][BCDA 11 22 12]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD 12  7 13][DABC 13 12 14][CDAB 14 17 15][BCDA 15 22 16]
</span></span></span><span class="line"><span class="cl"><span class="cm">         
</span></span></span><span class="line"><span class="cl"><span class="cm">        此处T[i]有问题 应该是i-1 索引下标从0开始
</span></span></span><span class="line"><span class="cl"><span class="cm">        */</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="mi">7</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="mi">12</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  <span class="mi">17</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>  <span class="n">B</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>  <span class="mi">22</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>  <span class="mi">7</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>  <span class="mi">12</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="mi">17</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">6</span><span class="p">]);</span>  <span class="n">B</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>  <span class="mi">22</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>  <span class="mi">7</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">8</span><span class="p">]);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>  <span class="mi">12</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">9</span><span class="p">]);</span>  <span class="n">C</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="mi">17</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">10</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="mi">22</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">12</span><span class="p">]);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="mi">12</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">13</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="mi">17</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">14</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round1</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="mi">22</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">15</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Round 2. */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Let [abcd k s i] denote the operation
</span></span></span><span class="line"><span class="cl"><span class="cm">            a = b + ((a + G(b,c,d) + X[k] + T[i]) &lt;&lt;&lt; s). */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Do the following 16 operations.
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  1  5 17][DABC  6  9 18][CDAB 11 14 19][BCDA  0 20 20]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  5  5 21][DABC 10  9 22][CDAB 15 14 23][BCDA  4 20 24]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  9  5 25][DABC 14  9 26][CDAB  3 14 27][BCDA  8 20 28]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD 13  5 29][DABC  2  9 30][CDAB  7 14 31][BCDA 12 20 32]
</span></span></span><span class="line"><span class="cl"><span class="cm">        */</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="mi">5</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">16</span><span class="p">]);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="mi">9</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">17</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="mi">14</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">18</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="mi">20</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">19</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>  <span class="mi">5</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">20</span><span class="p">]);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">21</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="mi">14</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">22</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>  <span class="mi">20</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">23</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>  <span class="mi">5</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">24</span><span class="p">]);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">25</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>  <span class="mi">14</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">26</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>  <span class="mi">20</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">27</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">28</span><span class="p">]);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  <span class="mi">9</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">29</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>  <span class="mi">14</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">30</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round2</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="mi">20</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">31</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Round 3. */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Let [abcd k s t] denote the operation
</span></span></span><span class="line"><span class="cl"><span class="cm">            a = b + ((a + H(b,c,d) + X[k] + T[i]) &lt;&lt;&lt; s). */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Do the following 16 operations.
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  5  4 33][DABC  8 11 34][CDAB 11 16 35][BCDA 14 23 36]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  1  4 37][DABC  4 11 38][CDAB  7 16 39][BCDA 10 23 40]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD 13  4 41][DABC  0 11 42][CDAB  3 16 43][BCDA  6 23 44]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  9  4 45][DABC 12 11 46][CDAB 15 16 47][BCDA  2 23 48]
</span></span></span><span class="line"><span class="cl"><span class="cm">        */</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>  <span class="mi">4</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">32</span><span class="p">]);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>  <span class="mi">11</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">33</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="mi">16</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">34</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="mi">23</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">35</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="mi">4</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">36</span><span class="p">]);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>  <span class="mi">11</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">37</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>  <span class="mi">16</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">38</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="mi">23</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">39</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">40</span><span class="p">]);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="mi">11</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">41</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>  <span class="mi">16</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">42</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="mi">23</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">43</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>  <span class="mi">4</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">44</span><span class="p">]);</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="mi">11</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">45</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="mi">16</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">46</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round3</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  <span class="mi">23</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">47</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Round 4. */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Let [abcd k s t] denote the operation
</span></span></span><span class="line"><span class="cl"><span class="cm">            a = b + ((a + I(b,c,d) + X[k] + T[i]) &lt;&lt;&lt; s). */</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Do the following 16 operations.
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  0  6 49][DABC  7 10 50][CDAB 14 15 51][BCDA  5 21 52]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD 12  6 53][DABC  3 10 54][CDAB 10 15 55][BCDA  1 21 56]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  8  6 57][DABC 15 10 58][CDAB  6 15 59][BCDA 13 21 60]
</span></span></span><span class="line"><span class="cl"><span class="cm">        [ABCD  4  6 61][DABC 11 10 62][CDAB  2 15 63][BCDA  9 21 64]
</span></span></span><span class="line"><span class="cl"><span class="cm">        */</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="mi">6</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">48</span><span class="p">]);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>  <span class="mi">10</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">49</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="mi">15</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">50</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>  <span class="mi">21</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">51</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">52</span><span class="p">]);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>  <span class="mi">10</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">53</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="mi">15</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">54</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="mi">21</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">55</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>  <span class="mi">6</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">56</span><span class="p">]);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="mi">10</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">57</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="mi">15</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">58</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="mi">21</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">59</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>  <span class="mi">6</span><span class="p">,</span>  <span class="n">T</span><span class="p">[</span><span class="mi">60</span><span class="p">]);</span>  <span class="n">D</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="mi">10</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">61</span><span class="p">]);</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  <span class="mi">15</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">62</span><span class="p">]);</span> <span class="n">B</span> <span class="o">=</span> <span class="n">Round4</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>  <span class="mi">21</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">63</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* Then perform the following additions. (That is, increment each
</span></span></span><span class="line"><span class="cl"><span class="cm">        of the four registers by the value it had before this block
</span></span></span><span class="line"><span class="cl"><span class="cm">        was started.) */</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">AA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">B</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">BB</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">C</span> <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">CC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">D</span> <span class="o">=</span> <span class="n">D</span> <span class="o">+</span> <span class="n">DD</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// step 5: 输出ABCD
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">memcpy</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">memcpy</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="mi">12</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">D</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">free</span><span class="p">(</span><span class="n">M</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">digest</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="n">md5</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="s">&#34;Hello World!&#34;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;Hello World!&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
            <footer class="footline">

            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
</div>
            </header>
<h1 id="2-签名算法">2 签名算法</h1>

<p>原文来自：https://www.cnblogs.com/Kingfans/p/16546386.html</p>
<h2 id="简介">简介</h2>
<p>SHA (Security Hash Algorithm) 是美国的 NIST 和 NSA 设计的一种标准的 Hash 算法，SHA 用于数字签名的标准算法的 DSS 中，也是安全性很高的一种 Hash 算法。</p>
<h2 id="sha系列家族">SHA系列家族</h2>
<p>　　

<ul class="children children-li children-sort-weight">
	
<li><a href="./1_algorithms/2_hash/2_sha/1_sha1/index.html">1 SHA1 算法</a></li>
<li><a href="./1_algorithms/2_hash/2_sha/2_sha2_224/index.html">2 SHA2-224 算法</a></li>
<li><a href="./1_algorithms/2_hash/2_sha/3_sha2_256/index.html">3 SHA2-256 算法</a></li>
<li><a href="./1_algorithms/2_hash/2_sha/4_sha2_384/index.html">4 SHA2-384 算法</a></li>
<li><a href="./1_algorithms/2_hash/2_sha/5_sha2_512/index.html">5 SHA2-512 算法</a></li>
</ul></p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">2 签名算法 的子部分</h1>
          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
  <a class="tag-link" href="./tags/sha/index.html">SHA</a>
</div>
            </header>
<h1 id="1-sha1-算法">1 SHA1 算法</h1>

<p>原文来自</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
  <a class="tag-link" href="./tags/sha/index.html">SHA</a>
</div>
            </header>
<h1 id="2-sha2-224-算法">2 SHA2-224 算法</h1>

<p>原文来自</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
  <a class="tag-link" href="./tags/sha/index.html">SHA</a>
</div>
            </header>
<h1 id="3-sha2-256-算法">3 SHA2-256 算法</h1>

<p>原文来自</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
  <a class="tag-link" href="./tags/sha/index.html">SHA</a>
</div>
            </header>
<h1 id="4-sha2-384-算法">4 SHA2-384 算法</h1>

<p>原文来自</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
  <a class="tag-link" href="./tags/sha/index.html">SHA</a>
</div>
            </header>
<h1 id="5-sha2-512-算法">5 SHA2-512 算法</h1>

<p>原文来自</p>

            <footer class="footline">

            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/crc/index.html">CRC</a>
  <a class="tag-link" href="./tags/hash/index.html">Hash</a>
</div>
            </header>
<h1 id="3-crc-哈希函数">3 CRC 哈希函数</h1>

<h2 id="crc-系列算法">CRC 系列算法</h2>

            <footer class="footline">

            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="3-位运算快速算法">3 位运算快速算法</h1>

<h2 id="位运算符">位运算符</h2>
<hr>
<ul>
<li>&amp; 位与： 0 &amp; 0 = 0 ; 0 &amp; 1 = 0 ; 1 &amp; 0 = 0 ;1 &amp; 1 = 1 ; 同为 1 时， 结果为 1。</li>
<li>| 位或： 0 | 0 = 0 ; 0 | 1 = 1 ; 1 | 0 = 1 ;1 | 1 = 1 ; 存在 1 时， 结果为 1。</li>
<li>^ 位异或： 0 &amp; 0 = 0 ; 0 &amp; 1 = 1 ; 1 &amp; 0 = 1 ;1 &amp; 1 = 0 ; 值相异时， 结果为 1。</li>
<li>~ 位反： ~ 0 = 1 ; ~ 1 = 0 ;</li>
<li>&laquo; 左移:</li>
<li>&gt;&gt; 逻辑右移：</li>
<li>&gt;&raquo; 算术右移：</li>
</ul>
<h2 id="目录">目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./1_algorithms/3_bitwise/1_average/index.html">1 快速平均值</a><ul>
	</ul></li>
<li><a href="./1_algorithms/3_bitwise/2_bitfield/index.html">2 位域值提取</a><ul>
	</ul></li>
<li><a href="./1_algorithms/3_bitwise/3_intmaxmin/index.html">3 使用按位运算计算INT_MAX和INT_MIN</a><ul>
	</ul></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">3 位运算快速算法 的子部分</h1>
          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/bitwise/index.html">Bitwise</a>
</div>
            </header>
<h1 id="1-快速平均值">1 快速平均值</h1>

<h2 id="符号定义">符号定义</h2>
<hr>
<ul>
<li>a :待运算的值</li>
<li>b :待运算的值</li>
<li>r :运算结果</li>
</ul>
<h2 id="计算">计算</h2>
<hr>
<pre><code>r = (a + b) &gt;&gt; 1
</code></pre>
<h2 id="总结">总结</h2>
<hr>
<p>&gt;&gt; 1 ,相当于 除 2。</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/bitwise/index.html">Bitwise</a>
</div>
            </header>
<h1 id="2-位域值提取">2 位域值提取</h1>

<h2 id="位域定义">位域定义</h2>
<p>C语言中的位域定义：</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">Bits</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="nl">b2</span><span class="p">:</span><span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="nl">b4</span><span class="p">:</span><span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>提取位域定义的值算法如下：</p>
<h2 id="符号定义">符号定义：</h2>
<ul>
<li>w :定义的位宽，如 b2 的位宽为 2 bit；</li>
<li>p :位域字段的位偏移，如 b2 的位偏移为 0，b4 的位偏移为 2；</li>
<li>v :位域字段所在的整体数据值，如 b2 就在 uint32_t 的数据上；</li>
<li>r :计算的结果；</li>
</ul>
<h3 id="第1步计算位域掩码">第1步：计算位域掩码</h3>
<pre><code>mask = (1 &lt;&lt; w) - 1
</code></pre>
<h3 id="第2步逻辑右移">第2步：逻辑右移</h3>
<pre><code>tv = v &gt;&gt; p
</code></pre>
<h3 id="第3步截取域至">第3步：截取域至</h3>
<pre><code>v = tv &amp; mask
</code></pre>
<h3 id="总结">总结</h3>
<pre><code>r = (v &gt;&gt; p) &amp; ( (1 &lt;&lt; w) - 1)
</code></pre>
<p>如果v是有符号数，就需要进行符号扩展。</p>
<h3 id="符号扩展">符号扩展</h3>
<h3 id="第1步计算符号掩码">第1步：计算符号掩码</h3>
<pre><code>smask = 1 &lt;&lt; (w-1)
</code></pre>
<h3 id="第2步计算符号位值">第2步：计算符号位值</h3>
<pre><code>signed = r &amp; smask
</code></pre>
<h3 id="第3步符号扩展">第3步：符号扩展</h3>
<p>signed != 0 ? ( r = r | (-1 &laquo; w) ) : r</p>
<h3 id="总结-1">总结</h3>
<p>( (1 &laquo; (w-1)) &amp; r) != 0 ? ( r = r | (-1 &laquo; w) ) : r</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/bitwise/index.html">Bitwise</a>
</div>
            </header>
<h1 id="3-使用按位运算计算int_max和int_min">3 使用按位运算计算INT_MAX和INT_MIN</h1>

<h2 id="假设">假设</h2>
<p>假设您有一个 32 位系统：</p>
<ul>
<li>INT_MAX是 01111111111111111111111111111111 ；</li>
<li>INT_MIN是 10000000000000000000000000000000 ；</li>
</ul>
<p>0 和 1 分别位于最高有效位位置，分别表示符号位。</p>
<p>计算INT_MAX和INT_MIN 在 C/C++ 中：
数字 0 表示为 000&hellip;000（32个）。</p>
<h2 id="原理">原理</h2>
<p>我们计算 0 的 NOT 得到一个有 32 个 1 的数字。这个数字不等于INT_MAX因为符号位是1，即负数。
现在，这个数字的右移将产生011&hellip;111 这是INT_MAX。
将INT_MAX 按位取反 就得到INT_MIN。</p>
<h2 id="代码">代码</h2>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">max</span> <span class="o">=</span> <span class="o">~</span><span class="n">max</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">max</span> <span class="o">=</span> <span class="n">max</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">min</span> <span class="o">=</span> <span class="o">~</span><span class="n">max</span><span class="p">;</span> 
</span></span></code></pre></div>
            <footer class="footline">

            </footer>
          </article>

          </section>
          </section>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="数据结构">数据结构</h1>

<h3 id="目录">目录</h3>
<ul>
<li><strong><a href="./2_struct/list/">链表</a></strong>
<ul>
<li><em><a href="./2_struct/list/singlelinkedlist/">单向节点链表</a></em></li>
<li><em><a href="./2_struct/list/doublelinkedlist/">双向节点链表</a></em></li>
</ul>
</li>
<li>待续</li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">数据结构 的子部分</h1>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第1章</div>
<h1 id="链表">链表</h1>


<ul class="children children-li children-sort-weight">
	
<li><a href="./2_struct/list/singlelinkedlist/index.html">单向节点链表</a></li>
<li><a href="./2_struct/list/doublelinkedlist/index.html">双向节点链表</a></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">链表 的子部分</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="单向节点链表">单向节点链表</h1>


            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class="tags">
  <a class="tag-link" href="./tags/cxx/index.html">Cxx</a>
  <a class="tag-link" href="./tags/list/index.html">List</a>
</div>
            </header>
<h1 id="双向节点链表">双向节点链表</h1>

<h2 id="节点模板类定义">节点模板类定义</h2>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">    <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Node</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">IListNode</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Node</span> <span class="o">*</span><span class="n">mNext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Node</span> <span class="o">*</span><span class="n">mPrev</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="kr">inline</span> <span class="n">IListNode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="o">:</span> <span class="n">mNext</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">mPrev</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 初始化节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span> <span class="n">mNext</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">mPrev</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 获取后继节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">getNext</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">mNext</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 获取前驱节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">getPrev</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">mPrev</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 设置后继节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">setNext</span><span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span> <span class="n">mNext</span> <span class="o">=</span> <span class="n">next</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 设置前驱节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">setPrev</span><span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="n">prev</span><span class="p">)</span> <span class="p">{</span> <span class="n">mPrev</span> <span class="o">=</span> <span class="n">prev</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 设置节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">setNode</span><span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="n">next</span><span class="p">,</span> <span class="n">Node</span> <span class="o">*</span><span class="n">prev</span><span class="p">)</span> <span class="p">{</span> <span class="n">mNext</span> <span class="o">=</span> <span class="n">next</span><span class="p">,</span> <span class="n">mPrev</span> <span class="o">=</span> <span class="n">prev</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span></span></span></code></pre></div><h2 id="链表模板类定义">链表模板类定义</h2>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">    <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Node</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">IList</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">IListNode</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">mRoot</span><span class="p">;</span> <span class="c1">// 链表根节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">uint</span> <span class="n">mCount</span><span class="p">;</span>           <span class="c1">// 节点计数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 链表初始化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="n">IList</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="o">:</span> <span class="n">mCount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">mRoot</span><span class="p">.</span><span class="n">setNode</span><span class="p">((</span><span class="n">Node</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mRoot</span><span class="p">,</span> <span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mRoot</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 初始链表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">initList</span><span class="p">()</span> <span class="p">{</span> <span class="n">mCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mRoot</span><span class="p">.</span><span class="n">setNode</span><span class="p">((</span><span class="n">Node</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mRoot</span><span class="p">,</span> <span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mRoot</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 获取根，只读
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">getRoot</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mRoot</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 获取节点计数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="n">uint</span> <span class="nf">getCount</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">mCount</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 获取第一个节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">getEntry</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Node</span> <span class="o">*</span><span class="n">ret</span> <span class="o">=</span> <span class="n">mRoot</span><span class="p">.</span><span class="n">getNext</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">           <span class="cm">/* if (ret == &amp;mRoot)
</span></span></span><span class="line"><span class="cl"><span class="cm">                ret = nullptr;*/</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kr">inline</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">front</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getEntry</span><span class="p">();</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 获取最后一个节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">getTail</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Node</span> <span class="o">*</span><span class="n">ret</span> <span class="o">=</span> <span class="n">mRoot</span><span class="p">.</span><span class="n">getPrev</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">             <span class="cm">/* if (ret == &amp;mRoot)
</span></span></span><span class="line"><span class="cl"><span class="cm">                ret = nullptr;*/</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kr">inline</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">back</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getTail</span><span class="p">();</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 从头部插入
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">insertEntry</span><span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="n">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Node</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="n">mRoot</span><span class="p">.</span><span class="n">getNext</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">node</span><span class="o">-&gt;</span><span class="n">setPrev</span><span class="p">((</span><span class="n">Node</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mRoot</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">node</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">head</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">head</span><span class="o">-&gt;</span><span class="n">setPrev</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">mRoot</span><span class="p">.</span><span class="n">setNext</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">++</span><span class="n">mCount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 从尾部插入
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">insertTail</span><span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="n">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Node</span> <span class="o">*</span><span class="n">tail</span> <span class="o">=</span> <span class="n">mRoot</span><span class="p">.</span><span class="n">getPrev</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">node</span><span class="o">-&gt;</span><span class="n">setPrev</span><span class="p">(</span><span class="n">tail</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">node</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">((</span><span class="n">Node</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mRoot</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">tail</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">mRoot</span><span class="p">.</span><span class="n">setPrev</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">++</span><span class="n">mCount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 从iter前面插入
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="n">iter</span><span class="p">,</span> <span class="n">Node</span> <span class="o">*</span><span class="n">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">iter</span><span class="o">-&gt;</span><span class="n">getPrev</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">node</span><span class="o">-&gt;</span><span class="n">setPrev</span><span class="p">(</span><span class="n">iter</span><span class="o">-&gt;</span><span class="n">getPrev</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">            <span class="n">node</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">iter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">iter</span><span class="o">-&gt;</span><span class="n">setPrev</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">++</span><span class="n">mCount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 移除节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">remove</span><span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="n">entry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 根节点并不能移除
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">((</span><span class="n">Node</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mRoot</span> <span class="o">==</span> <span class="n">entry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">Node</span> <span class="o">*</span><span class="n">prev</span> <span class="o">=</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">getPrev</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">Node</span> <span class="o">*</span><span class="n">next</span> <span class="o">=</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">getNext</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">prev</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">next</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">next</span><span class="o">-&gt;</span><span class="n">setPrev</span><span class="p">(</span><span class="n">prev</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">entry</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="o">--</span><span class="n">mCount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">entry</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 移除头部节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">removeEntry</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">remove</span><span class="p">(</span><span class="n">mRoot</span><span class="p">.</span><span class="n">getNext</span><span class="p">());</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 移除尾部节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">inline</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">removeTail</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">remove</span><span class="p">(</span><span class="n">mRoot</span><span class="p">.</span><span class="n">getPrev</span><span class="p">());</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span></span></span></code></pre></div>
            <footer class="footline">

            </footer>
          </article>

          </section>
          </section>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="编译原理">编译原理</h1>

<h2 id="目录">目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./3_compiler/1_lexer/index.html">1 词法分析</a></li>
<li><a href="./3_compiler/2_parser/index.html">2 语法分析</a></li>
<li><a href="./3_compiler/3_analysis/index.html">3 语义分析</a></li>
<li><a href="./3_compiler/4_optimize/index.html">4 中间优化</a></li>
<li><a href="./3_compiler/5_target/index.html">5 目标生成</a></li>
<li><a href="./3_compiler/6_ir/index.html">6 中间代码</a></li>
<li><a href="./3_compiler/7_instruction/index.html">7 指令集</a></li>
<li><a href="./3_compiler/8_langdef/index.html">8 语言定义</a></li>
<li><a href="./3_compiler/9_bcf/index.html">9 字节码文件格式</a></li>
<li><a href="./3_compiler/10_vmimp/index.html">10 虚拟机设计与实现</a></li>
</ul>
<h2 id="引言">引言</h2>
<hr>
编译原理是将文本字符流，通过一系列的分析、转换，最后生成确定的指令文件的数据分析转换技术。
<p>编译器是利用编译原理，将一种程序（源程序）翻译成另一种程序（目标程序）的计算机程序。业界也将编译器分为三个部分：前端、中端、后端。</p>
<p>编译器所做的工作流程如下图所示。</p>
<p><a href="#image-bfd342c4ca8030c5ec16f92089b392f2" class="lightbox-link"><img src="./3_compiler/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.svg" alt="编译总流程" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="image-bfd342c4ca8030c5ec16f92089b392f2"><img src="./3_compiler/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.svg" alt="编译总流程" class="lightbox-image" loading="lazy"></a></p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">编译原理 的子部分</h1>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第1章</div>
<h1 id="1-词法分析">1 词法分析</h1>

<h2 id="1-序">1 序</h2>
<p>词法分析就是将代码字符流，按照一定的规则进行分析，获取符合词法规则的字符串，并进行信息标注，为语法分析提供单词(Token)流。</p>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./3_compiler/1_lexer/1_tokendef/index.html">1 Token 定义</a></li>
<li><a href="./3_compiler/1_lexer/2_lexer/index.html">2 Lexer 实现</a></li>
<li><a href="./3_compiler/1_lexer/3_project/index.html">3 工程文件解析</a></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">1 词法分析 的子部分</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="1-token-定义">1 Token 定义</h1>

<h2 id="1-词法规则">1 词法规则</h2>
<hr>
<p>词法分析按照规定的规则，可以从字符流中获取数据。</p>
<p>规则定义为以下几类：</p>
<ul>
<li>标识符：由字母、数字、下划线( _ )构成，但是不得由数字为起始；其中存在特殊的字符串为关键字。</li>
<li>普通数字字面量：由数字和&rsquo;.&lsquo;组成，其中分为整数、浮点数；</li>
<li>2进制数字字面量：由 &lsquo;0B&rsquo;起始，多个 &lsquo;0&rsquo;或'1&rsquo;构成。</li>
<li>16进制数字字面量：由 &lsquo;0X&rsquo;起始，多个 十六进制字符 构成。</li>
<li>字符字面量：由 &lsquo;&lsquo;&lsquo;起始和结尾，中间为可打印的字符。</li>
</ul>
<h2 id="2-token-分类">2 Token 分类</h2>
<hr>
<h2 id="3-位置信息">3 位置信息</h2>
<hr>
<h2 id="3-token-定义">3 Token 定义</h2>
<hr>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="2-lexer-实现">2 Lexer 实现</h1>

<p>待续</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="3-工程文件解析">3 工程文件解析</h1>

<p>待续</p>

            <footer class="footline">

            </footer>
          </article>

          </section>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第2章</div>
<h1 id="2-语法分析">2 语法分析</h1>

<h2 id="1-序">1 序</h2>
<p>语法分析就是将词法分析提供单词(Token)流，按照语法规则构建抽象语法分析树，为语义分析提供数据骨架。</p>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./3_compiler/2_parser/1_typesystem/index.html">1 类型系统设计与实现</a></li>
<li><a href="./3_compiler/2_parser/2_astnode/index.html">2 抽象语法树设计与实现</a></li>
<li><a href="./3_compiler/2_parser/3_fileunit/index.html">3 代码文件文件管理</a></li>
<li><a href="./3_compiler/2_parser/4_parserbase/index.html">4 顶层语法解析实现</a></li>
<li><a href="./3_compiler/2_parser/5_parserexp/index.html">5 解析表达式</a></li>
<li><a href="./3_compiler/2_parser/6_parserdecl/index.html">6 解析声明</a></li>
<li><a href="./3_compiler/2_parser/7_parserdecl2/index.html">7 解析声明续</a></li>
</ul>
            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">2 语法分析 的子部分</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="1-类型系统设计与实现">1 类型系统设计与实现</h1>

<p>待续</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="2-抽象语法树设计与实现">2 抽象语法树设计与实现</h1>

<p>待续</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="3-代码文件文件管理">3 代码文件文件管理</h1>

<p>待续</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="4-顶层语法解析实现">4 顶层语法解析实现</h1>

<p>待续</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="5-解析表达式">5 解析表达式</h1>

<p>待续</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="6-解析声明">6 解析声明</h1>

<p>待续</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="7-解析声明续">7 解析声明续</h1>

<p>待续</p>

            <footer class="footline">

            </footer>
          </article>

          </section>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第3章</div>
<h1 id="3-语义分析">3 语义分析</h1>

<h2 id="1-序">1 序</h2>
<p>语义分析就是分析语法树中所有的符号是否存在声明，从语义层次进一步规范程序所表达的含义。</p>
<ul>
<li>分析符号的含义和类型。</li>
<li>分析变量的位置偏移。</li>
<li>分析表达式的类型，并进行类型匹配。</li>
</ul>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
</ul>
            <footer class="footline">

            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第4章</div>
<h1 id="4-中间优化">4 中间优化</h1>


            <footer class="footline">

            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第5章</div>
<h1 id="5-目标生成">5 目标生成</h1>


            <footer class="footline">

            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第6章</div>
<h1 id="6-中间代码">6 中间代码</h1>


            <footer class="footline">

            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第7章</div>
<h1 id="7-指令集">7 指令集</h1>

<h2 id="1-序">1 序</h2>
<p>指令集可分为两大类，真实硬件指令集和虚拟机指令集。</p>
<p>真实硬件指令集又分为两类：</p>
<ul>
<li>CISC (复杂指令集)：CISC 以 X86 系列为代表，指令系统较为复杂，硬件实现也比较复杂。</li>
<li>RISC (精简指令集)：RISC 的指令系统较为精简，目的是降低硬件实现的复杂度，以 RISC-V 、ARM为代表。</li>
</ul>
<p>虚拟机指令集可分为三种：</p>
<ul>
<li>基于栈的指令集：纯栈操作，所有的运算都基于栈，其中以 Java 字节码指令集为代表。</li>
<li>基于寄存器的指令集：纯寄存器操作，所有的运算基于寄存器，其中以安卓的 Dalvik 字节码指令集为代表。</li>
<li>基于栈和寄存器的指令集：混合式操作，类似于 RISC 指令集，但是又与真实硬件系统有差异。</li>
</ul>
<p>虚拟机的指令与设计的字节码保存文件存在较强相关性，所以要真正理解虚拟机指令，还需要理解字节码文件的存储格式。</p>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./3_compiler/7_instruction/1_stackbasedinsset/index.html">1 基于栈的指令集</a></li>
<li><a href="./3_compiler/7_instruction/2_registerbasedinsset/index.html">2 基于寄存器的指令集</a></li>
<li><a href="./3_compiler/7_instruction/3_mixedinsset/index.html">3 基于栈和寄存器的指令集</a></li>
</ul>
            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">7 指令集 的子部分</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="1-基于栈的指令集">1 基于栈的指令集</h1>

<p>基于栈的指令集参考Java的指令集。</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="2-基于寄存器的指令集">2 基于寄存器的指令集</h1>

<p>Dalvik 字节码指令集的字节码指令集不支持无符号整数运算，因此参照 Dalvik 设计了以下指令集。</p>
<p>基于纯寄存器的指令集，指令系统存在下列的要求：</p>
<ul>
<li>每条指令按照 16 bit 对齐。</li>
<li>寄存器的索引位宽有 4 bit、8 bit、16 bit。</li>
<li>最多支持 65536 个寄存器。</li>
<li>每个寄存器 32 bit。</li>
<li>64 bit寄存器由相邻的两个 32 bit 寄存器组合而成。</li>
<li>指令操作码位宽为 8 bit。</li>
<li>指令中可有子操作码，具体位宽看具体的指令格式。</li>
<li>32 bit 寄存器内可以存储 32 bit的整数、浮点数。</li>
<li>64 bit 寄存器内可以存储 64 bit的整数、浮点数。</li>
<li>位宽小于 32 位的值，需要进行扩展（零扩展、符号扩展）到 32 bit。</li>
<li>助记符中的 I 表示寄存器索引，后面的数字表示索引位宽</li>
</ul>
<h3 id="指令格式">指令格式</h3>
<p>总体格式：</p>
<pre><code>操作码 + [ 操作子码 ] + ( 操作数 )*
</code></pre>
<ul>
<li>操作子码可选。</li>
<li>操作数可以有多个。</li>
</ul>
<p>寄存器位宽索引支持的寄存器数量：</p>
<table>
<thead>
<tr>
<th>位宽</th>
<th>寄存器数量</th>
<th>索引范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>4 bit</td>
<td>16</td>
<td>[ 0, 15 ]</td>
</tr>
<tr>
<td>8 bit</td>
<td>256</td>
<td>[ 0, 255 ]</td>
</tr>
<tr>
<td>16 bit</td>
<td>65536</td>
<td>[ 0, 65535 ]</td>
</tr>
</tbody>
</table>
<h3 id="空指令">空指令</h3>
<p>文本格式： nop</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>对齐</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>格式</td>
<td>8 bit</td>
<td>8bit</td>
<td>指令宽度：16 bit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>nop</td>
<td>0</td>
<td></td>
<td>空操作，用于对齐</td>
</tr>
</tbody>
</table>
<h3 id="常量赋值指令">常量赋值指令</h3>
<h4 id="文本格式-op-des-imm">文本格式： op des, imm</h4>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的寄存器</th>
<th>立即数</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td>4 bit</td>
<td>4 bit</td>
<td>4 bit 立即数，指令宽度：16 bit</td>
</tr>
<tr>
<td>const-w32-I4-i4</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为有符号整数，有符号扩展至 32 bit。</td>
</tr>
<tr>
<td>const-w64-I4-i4</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为有符号整数，有符号扩展至 32 bit。</td>
</tr>
<tr>
<td>const-w32-I4-u4</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为无符号整数，无符号扩展至 32 bit。</td>
</tr>
<tr>
<td>const-w64-I4-u4</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为无符号整数，无符号扩展至 32 bit。</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>16 bit 立即数，指令宽度：32 bit</td>
</tr>
<tr>
<td>const-w32-I8-i16</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为有符号整数，有符号扩展至 32 bit。</td>
</tr>
<tr>
<td>const-w64-I8-i16</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为有符号整数，有符号扩展至 64 bit。</td>
</tr>
<tr>
<td>const-w32-I8-u16</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为无符号整数，无符号扩展至 32 bit。</td>
</tr>
<tr>
<td>const-w64-I8-u16</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为无符号整数，无符号扩展至 64 bit。</td>
</tr>
<tr>
<td>const-w32-I8-L16</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为无符号整数。imm 存放在寄存器的低 16 bit，不改变高 16 bit。</td>
</tr>
<tr>
<td>const-w32-I8-H16</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为无符号整数。imm 存放在寄存器的高 16 bit，不改变低 16 bit。</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>32 bit</td>
<td>32 bit 立即数，指令宽度：48 bit</td>
</tr>
<tr>
<td>const-w32-I8</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>原样拷贝，支持32 bit 整数和浮点。</td>
</tr>
<tr>
<td>const-w64-I8-i32</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为有符号整数，有符号扩展至 64 bit。</td>
</tr>
<tr>
<td>const-w64-I8-u32</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>imm 为无符号整数，无符号扩展至 64 bit。</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>64 bit</td>
<td>64 bit 立即数，指令宽度：80 bit</td>
</tr>
<tr>
<td>const-w64-I8</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>原样拷贝，支持64 bit整数和浮点。</td>
</tr>
</tbody>
</table>
<h4 id="文本格式opsub-desimm">文本格式：op.sub des,imm</h4>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>操作子码</th>
<th>目的寄存器</th>
<th>立即数</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>8 bit</td>
<td>8 bit</td>
<td>指令宽度：32 bit</td>
</tr>
<tr>
<td>const-w32-I8</td>
<td></td>
<td>subop</td>
<td>des</td>
<td>imm</td>
<td>imm 为无符号整数</td>
</tr>
</tbody>
</table>
<h4 id="操作子码定义">操作子码定义</h4>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作子码</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>B0</td>
<td></td>
<td>imm存放在寄存器的第 1 个字节，不改变其他字节。</td>
</tr>
<tr>
<td>B1</td>
<td></td>
<td>imm存放在寄存器的第 2 个字节，不改变其他字节。</td>
</tr>
<tr>
<td>B2</td>
<td></td>
<td>imm存放在寄存器的第 3 个字节，不改变其他字节。</td>
</tr>
<tr>
<td>B3</td>
<td></td>
<td>imm存放在寄存器的第 4 个字节，不改变其他字节。</td>
</tr>
</tbody>
</table>
<h3 id="寄存器赋值指令">寄存器赋值指令</h3>
<p>文本格式：op des,src</p>
<h4 id="文本格式op-dessrc">文本格式：op des,src</h4>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的寄存器</th>
<th>源寄存器</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td>4 bit</td>
<td>4 bit</td>
<td>指令宽度：16 bit</td>
</tr>
<tr>
<td>move-w32-I4</td>
<td></td>
<td>des</td>
<td>src</td>
<td>32 位寄存器值传递</td>
</tr>
<tr>
<td>move-w64-I4</td>
<td></td>
<td>des</td>
<td>src</td>
<td>64 位寄存器值传递</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>指令宽度：32 bit</td>
</tr>
<tr>
<td>move-w32-I8I16</td>
<td></td>
<td>des</td>
<td>src</td>
<td>32 位寄存器值传递</td>
</tr>
<tr>
<td>move-w64-I8I16</td>
<td></td>
<td>des</td>
<td>src</td>
<td>64 位寄存器值传递</td>
</tr>
</tbody>
</table>
<h4 id="文本格式opsub-dessrc">文本格式：op.sub des,src</h4>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>操作子码</th>
<th>目的寄存器</th>
<th>源寄存器</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>8 bit</td>
<td>8 bit</td>
<td>指令宽度：32 bit</td>
</tr>
<tr>
<td>mov-I8</td>
<td>sub</td>
<td>des</td>
<td>src</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>16 bit</td>
<td>指令宽度：48 bit</td>
</tr>
<tr>
<td>mov-I16</td>
<td>sub</td>
<td>des</td>
<td>src</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="操作子码定义-1">操作子码定义</h4>
<p>助记符含义：</p>
<ul>
<li>
<p>目标位宽-源数据获取转换位宽</p>
<ul>
<li>i:符号扩展。</li>
<li>u:零扩展。</li>
<li>只有目标位宽时，表示源位宽直接拷贝传递。</li>
</ul>
</li>
<li>
<p>目标类型-源类型</p>
<ul>
<li>表示从源类型转换到目标类型</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作子码</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>w32-B0-i8</td>
<td>0</td>
<td>获取寄存器的第 1 个字节，进行符号扩展到 32 位</td>
</tr>
<tr>
<td>w32-B0-u8</td>
<td>1</td>
<td>获取寄存器的第 1 个字节，进行零扩展到 32 位</td>
</tr>
<tr>
<td>w32-B1-i8</td>
<td>2</td>
<td>获取寄存器的第 2 个字节，进行符号扩展到 32 位</td>
</tr>
<tr>
<td>w32-B1-u8</td>
<td>3</td>
<td>获取寄存器的第 2 个字节，进行零扩展到 32 位</td>
</tr>
<tr>
<td>w32-B2-i8</td>
<td>4</td>
<td>获取寄存器的第 3 个字节，进行符号扩展到 32 位</td>
</tr>
<tr>
<td>w32-B2-u8</td>
<td>5</td>
<td>获取寄存器的第 3 个字节，进行零扩展到 32 位</td>
</tr>
<tr>
<td>w32-B3-i8</td>
<td>6</td>
<td>获取寄存器的第 4 个字节，进行符号扩展到 32 位</td>
</tr>
<tr>
<td>w32-B3-u8</td>
<td>7</td>
<td>获取寄存器的第 4 个字节，进行零扩展到 32 位</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>w32-L16-i16</td>
<td>8</td>
<td>获取寄存器的低 16 位，进行符号扩展到 32 位</td>
</tr>
<tr>
<td>w32-L16-u16</td>
<td>9</td>
<td>获取寄存器的低 16 位，进行零扩展到 32 位</td>
</tr>
<tr>
<td>w32-H16-i16</td>
<td>10</td>
<td>获取寄存器的高 16 位，进行符号扩展到 32 位</td>
</tr>
<tr>
<td>w32-H16-u16</td>
<td>11</td>
<td>获取寄存器的高 16 位，进行零扩展到 32 位</td>
</tr>
<tr>
<td>w32</td>
<td>12</td>
<td>32 位原值拷贝传递</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>w64-B0-i8</td>
<td>13</td>
<td>获取寄存器的第 1 个字节，进行符号扩展到 64 位</td>
</tr>
<tr>
<td>w64-B0-u8</td>
<td>14</td>
<td>获取寄存器的第 1 个字节，进行零扩展到 64 位</td>
</tr>
<tr>
<td>w64-B1-i8</td>
<td>15</td>
<td>获取寄存器的第 2 个字节，进行符号扩展到 64 位</td>
</tr>
<tr>
<td>w64-B1-u8</td>
<td>16</td>
<td>获取寄存器的第 2 个字节，进行零扩展到 64 位</td>
</tr>
<tr>
<td>w64-B2-i8</td>
<td>17</td>
<td>获取寄存器的第 3 个字节，进行符号扩展到 64 位</td>
</tr>
<tr>
<td>w64-B2-u8</td>
<td>18</td>
<td>获取寄存器的第 3 个字节，进行零扩展到 64 位</td>
</tr>
<tr>
<td>w64-B3-i8</td>
<td>19</td>
<td>获取寄存器的第 4 个字节，进行符号扩展到 64 位</td>
</tr>
<tr>
<td>w64-B3-u8</td>
<td>20</td>
<td>获取寄存器的第 4 个字节，进行零扩展到 64 位</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>w64-L16-i16</td>
<td>21</td>
<td>获取寄存器的低 16 位，进行符号扩展到 32 位</td>
</tr>
<tr>
<td>w64-L16-u16</td>
<td>22</td>
<td>获取寄存器的低 16 位，进行零扩展到 32 位</td>
</tr>
<tr>
<td>w64-H16-i16</td>
<td>23</td>
<td>获取寄存器的高 16 位，进行符号扩展到 32 位</td>
</tr>
<tr>
<td>w64-H16-u16</td>
<td>24</td>
<td>获取寄存器的高 16 位，进行零扩展到 32 位</td>
</tr>
<tr>
<td>w64-i32</td>
<td>25</td>
<td>获取寄存器的 32 位，进行符号扩展到 64 位</td>
</tr>
<tr>
<td>w64-u32</td>
<td>26</td>
<td>获取寄存器的 32 位，进行零扩展到 64 位</td>
</tr>
<tr>
<td>w64</td>
<td>27</td>
<td>64 位原值拷贝传递</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>i32-f32</td>
<td>28</td>
<td>32 位有符号整数转 32 位浮点数</td>
</tr>
<tr>
<td>i32-f64</td>
<td>29</td>
<td>32 位有符号整数转 64 位浮点数</td>
</tr>
<tr>
<td>u32-f32</td>
<td>30</td>
<td>32 位无符号整数转 32 位浮点数</td>
</tr>
<tr>
<td>u32-f64</td>
<td>31</td>
<td>32 位无符号整数转 64 位浮点数</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>i64-f32</td>
<td>32</td>
<td>64 位有符号整数转 32 位浮点数</td>
</tr>
<tr>
<td>i64-f64</td>
<td>33</td>
<td>64 位有符号整数转 32 位浮点数</td>
</tr>
<tr>
<td>u64-f32</td>
<td>34</td>
<td>64 位无符号整数转 32 位浮点数</td>
</tr>
<tr>
<td>u64-f64</td>
<td>35</td>
<td>64 位无符号整数转 64 位浮点数</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>f32-i32</td>
<td>36</td>
<td>32 位浮点数转 32 位有符号</td>
</tr>
<tr>
<td>f32-i64</td>
<td>37</td>
<td>32 位浮点数转 64 位有符号</td>
</tr>
<tr>
<td>f32-u32</td>
<td>38</td>
<td>32 位浮点数转 32 位无符号</td>
</tr>
<tr>
<td>f32-u64</td>
<td>39</td>
<td>32 位浮点数转 64 位无符号</td>
</tr>
<tr>
<td>f32-f64</td>
<td>49</td>
<td>32 位浮点数转 64 位浮点数</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>f64-i32</td>
<td>41</td>
<td>64 位浮点数转 32 位有符号</td>
</tr>
<tr>
<td>f64-i64</td>
<td>42</td>
<td>64 位浮点数转 64 位有符号</td>
</tr>
<tr>
<td>f64-u32</td>
<td>43</td>
<td>64 位浮点数转 32 位无符号</td>
</tr>
<tr>
<td>f64-u64</td>
<td>44</td>
<td>64 位浮点数转 64 位无符号</td>
</tr>
<tr>
<td>f64-f32</td>
<td>45</td>
<td>64 位浮点数转 32 位浮点数</td>
</tr>
</tbody>
</table>
<h3 id="数学运算指令">数学运算指令</h3>
<ul>
<li>有二地址、三地址分类。</li>
<li>每类的主操作码不一致。</li>
</ul>
<h4 id="三地址操作">三地址操作</h4>
<p>三地址文本格式： op.sub des,src,src2</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>操作子码</th>
<th>目的寄存器</th>
<th>源寄存器</th>
<th>源操作数</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>8 bit</td>
<td>4 bit</td>
<td>4 bit</td>
<td>指令宽度：32 bit</td>
</tr>
<tr>
<td>math-I4</td>
<td></td>
<td>sub</td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>8 bit</td>
<td>8 bit</td>
<td>指令宽度：48 bit</td>
</tr>
<tr>
<td>math-I16I8</td>
<td></td>
<td>sub</td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>16 bit</td>
<td>16 bit</td>
<td>指令宽度：64 bit</td>
</tr>
<tr>
<td>math-I16</td>
<td></td>
<td>sub</td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="子码定义">子码定义</h4>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作子码</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>add-int32</td>
<td>0</td>
<td>32 位有符号 加 +</td>
</tr>
<tr>
<td>sub-int32</td>
<td>1</td>
<td>32 位有符号 减 -</td>
</tr>
<tr>
<td>mul-int32</td>
<td>2</td>
<td>32 位有符号 乘 *</td>
</tr>
<tr>
<td>div-int32</td>
<td>3</td>
<td>32 位有符号 除 /</td>
</tr>
<tr>
<td>mod-int32</td>
<td>4</td>
<td>32 位有符号 模 %</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-uint32</td>
<td>5</td>
<td>32 位无符号 加 +</td>
</tr>
<tr>
<td>sub-uint32</td>
<td>6</td>
<td>32 位无符号 减 -</td>
</tr>
<tr>
<td>mul-uint32</td>
<td>7</td>
<td>32 位无符号 乘 *</td>
</tr>
<tr>
<td>div-uint32</td>
<td>8</td>
<td>32 位无符号 除 /</td>
</tr>
<tr>
<td>mod-uint32</td>
<td>9</td>
<td>32 位无符号 模 %</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-int64</td>
<td>10</td>
<td>64 位有符号 加 +</td>
</tr>
<tr>
<td>sub-int64</td>
<td>11</td>
<td>64 位有符号 减 -</td>
</tr>
<tr>
<td>mul-int64</td>
<td>12</td>
<td>64 位有符号 乘 *</td>
</tr>
<tr>
<td>div-int64</td>
<td>13</td>
<td>64 位有符号 除 /</td>
</tr>
<tr>
<td>mod-int64</td>
<td>14</td>
<td>64 位有符号</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-uint64</td>
<td>15</td>
<td>64 位无符号 加 +</td>
</tr>
<tr>
<td>sub-uint64</td>
<td>16</td>
<td>64 位无符号 减 -</td>
</tr>
<tr>
<td>mul-uint64</td>
<td>17</td>
<td>64 位无符号 乘 *</td>
</tr>
<tr>
<td>div-uint64</td>
<td>18</td>
<td>64 位无符号 除 /</td>
</tr>
<tr>
<td>mod-uint64</td>
<td>19</td>
<td>64 位无符号 模 %</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-flt32</td>
<td>20</td>
<td>32 位浮点 加 +</td>
</tr>
<tr>
<td>sub-flt32</td>
<td>21</td>
<td>32 位浮点 减 -</td>
</tr>
<tr>
<td>mul-flt32</td>
<td>22</td>
<td>32 位浮点 乘 *</td>
</tr>
<tr>
<td>div-flt32</td>
<td>23</td>
<td>32 位浮点 除 /</td>
</tr>
<tr>
<td>mod-flt32</td>
<td>24</td>
<td>32 位浮点 模 %</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-flt64</td>
<td>25</td>
<td>64 位浮点 加 +</td>
</tr>
<tr>
<td>sub-flt64</td>
<td>26</td>
<td>64 位浮点 减 -</td>
</tr>
<tr>
<td>mul-flt64</td>
<td>27</td>
<td>64 位浮点 乘 *</td>
</tr>
<tr>
<td>div-flt64</td>
<td>28</td>
<td>64 位浮点 除 /</td>
</tr>
<tr>
<td>mod-flt64</td>
<td>29</td>
<td>64 位浮点 模 %</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>sl-w32</td>
<td>30</td>
<td>32 位 左移</td>
</tr>
<tr>
<td>sr-w32</td>
<td>31</td>
<td>32 位 右移</td>
</tr>
<tr>
<td>sra-w32</td>
<td>32</td>
<td>32 位 算术右移</td>
</tr>
<tr>
<td>rol-w32</td>
<td>33</td>
<td>32 位 循环左移</td>
</tr>
<tr>
<td>ror-w32</td>
<td>34</td>
<td>32 位 循环右移</td>
</tr>
<tr>
<td>and-w32</td>
<td>35</td>
<td>32 位 位与</td>
</tr>
<tr>
<td>or-w32</td>
<td>36</td>
<td>32 位  位或</td>
</tr>
<tr>
<td>xor-w32</td>
<td>37</td>
<td>32 位 位异或</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>sl-w64</td>
<td>38</td>
<td>64 位 左移</td>
</tr>
<tr>
<td>sr-w64</td>
<td>39</td>
<td>64 位 右移</td>
</tr>
<tr>
<td>sra-w64</td>
<td>40</td>
<td>64 位 算术右移</td>
</tr>
<tr>
<td>rol-w32</td>
<td>41</td>
<td>64 位 循环左移</td>
</tr>
<tr>
<td>ror-w32</td>
<td>42</td>
<td>64 位 循环右移</td>
</tr>
<tr>
<td>and-w64</td>
<td>43</td>
<td>64 位 位与</td>
</tr>
<tr>
<td>or-w64</td>
<td>44</td>
<td>64 位  位或</td>
</tr>
<tr>
<td>xor-w64</td>
<td>45</td>
<td>64 位 位异或</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>andl-w32</td>
<td>46</td>
<td>32 位 逻辑与</td>
</tr>
<tr>
<td>orl-w32</td>
<td>47</td>
<td>32 位 逻辑或</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>cmp-int32</td>
<td>48</td>
<td>src &lt; src2 : des=-1</td>
</tr>
<tr>
<td>cmp-uint32</td>
<td>49</td>
<td>src == src2 : des=0</td>
</tr>
<tr>
<td>cmp-int64</td>
<td>50</td>
<td>src &gt; src2 : des=1</td>
</tr>
<tr>
<td>cmp-uint64</td>
<td>51</td>
<td></td>
</tr>
<tr>
<td>cmp-flt32</td>
<td>52</td>
<td></td>
</tr>
<tr>
<td>cmp-flt64</td>
<td>53</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="二地址操作">二地址操作</h4>
<p>二地址文本格式： op.sub des,src</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>操作子码</th>
<th>目的寄存器</th>
<th>源寄存器</th>
<th>源操作数</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>8 bit</td>
<td>8 bit</td>
<td>指令宽度：32 bit</td>
<td></td>
</tr>
<tr>
<td>math-I8</td>
<td></td>
<td>sub</td>
<td>des</td>
<td>src</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>16 bit</td>
<td>指令宽度：48 bit</td>
<td></td>
</tr>
<tr>
<td>math-I16</td>
<td></td>
<td>sub</td>
<td>des</td>
<td>src</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="子码定义-1">子码定义</h4>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作子码</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>not-w32</td>
<td>0</td>
<td>32 位 按位取反</td>
</tr>
<tr>
<td>not-w64</td>
<td>1</td>
<td>64 位 按位取反</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>inv-w32</td>
<td>2</td>
<td>32 位 逻辑取反</td>
</tr>
<tr>
<td>inv-w64</td>
<td>3</td>
<td>64 位 逻辑取反</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>neg-int32</td>
<td>4</td>
<td>32 位 符号取反</td>
</tr>
<tr>
<td>neg-int64</td>
<td>5</td>
<td>64 位 符号取反</td>
</tr>
<tr>
<td>neg-flt32</td>
<td>6</td>
<td>32 位 符号取反</td>
</tr>
<tr>
<td>neg-flt64</td>
<td>7</td>
<td>64 位 符号取反</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>abs-int32</td>
<td>8</td>
<td>32 位 取绝对值</td>
</tr>
<tr>
<td>abs-int64</td>
<td>9</td>
<td>64 位 取绝对值</td>
</tr>
<tr>
<td>abs-flt32</td>
<td>10</td>
<td>32 位 取绝对值</td>
</tr>
<tr>
<td>abs-flt64</td>
<td>11</td>
<td>64 位 取绝对值</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>sin-flt32</td>
<td>12</td>
<td>三角函数</td>
</tr>
<tr>
<td>cos-flt32</td>
<td>13</td>
<td>三角函数</td>
</tr>
<tr>
<td>tan-flt32</td>
<td>14</td>
<td>三角函数</td>
</tr>
<tr>
<td>asin-flt32</td>
<td>15</td>
<td>三角函数</td>
</tr>
<tr>
<td>acos-flt32</td>
<td>16</td>
<td>三角函数</td>
</tr>
<tr>
<td>atan-flt32</td>
<td>17</td>
<td>三角函数</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>sin-flt64</td>
<td>18</td>
<td>三角函数</td>
</tr>
<tr>
<td>cos-flt64</td>
<td>19</td>
<td>三角函数</td>
</tr>
<tr>
<td>tan-flt64</td>
<td>20</td>
<td>三角函数</td>
</tr>
<tr>
<td>asin-flt64</td>
<td>21</td>
<td>三角函数</td>
</tr>
<tr>
<td>acos-flt64</td>
<td>22</td>
<td>三角函数</td>
</tr>
<tr>
<td>atan-flt64</td>
<td>23</td>
<td>三角函数</td>
</tr>
</tbody>
</table>
<h3 id="跳转指令">跳转指令</h3>
<h4 id="直接跳转指令">直接跳转指令</h4>
<p>文本格式： goto imm</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>对齐</th>
<th>立即数</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td></td>
<td>8 bit</td>
<td>指令宽度： 16 bit</td>
</tr>
<tr>
<td>goto8</td>
<td></td>
<td></td>
<td>imm</td>
<td>8 bit有符号偏移</td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>指令宽度： 32 bit</td>
</tr>
<tr>
<td>goto16</td>
<td></td>
<td></td>
<td>imm</td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>32 bit</td>
<td>指令宽度： 48 bit</td>
</tr>
<tr>
<td>goto32</td>
<td></td>
<td></td>
<td>imm</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="分支跳转指令">分支跳转指令</h4>
<h5 id="文本格式">文本格式</h5>
<pre><code>jbr src,src2,imm
jbr src,imm
</code></pre>
<ul>
<li>类型编码：标识操作数的类型。</li>
<li>操作子码：标识比较方法。</li>
<li>和 0 比较时，无源操作数 src2。</li>
</ul>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>操作子码</th>
<th>类型码</th>
<th>源操作数</th>
<th>源操作数</th>
<th>立即数</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td>4 bit</td>
<td>4 bit</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>指令宽度： 32 bit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>32 bit</td>
<td>指令宽度： 32 bit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>16 bit</td>
<td>16 bit</td>
<td>16 bit</td>
<td>指令宽度： 32 bit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>16 bit</td>
<td>16 bit</td>
<td>32 bit</td>
<td>指令宽度： 32 bit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>src</td>
<td>src2</td>
<td>imm</td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="操作子码">操作子码</h5>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作子码</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>eq</td>
<td>0</td>
<td>if( src == src2 ) goto imm</td>
</tr>
<tr>
<td>ne</td>
<td>1</td>
<td>if( src != src2 ) goto imm</td>
</tr>
<tr>
<td>lt</td>
<td>2</td>
<td>if( src &lt; src2 ) goto imm</td>
</tr>
<tr>
<td>le</td>
<td>3</td>
<td>if( src &lt;= src2 ) goto imm</td>
</tr>
<tr>
<td>gt</td>
<td>4</td>
<td>if( src &gt; src2 ) goto imm</td>
</tr>
<tr>
<td>ge</td>
<td>5</td>
<td>if( src &gt;= src2 ) goto imm</td>
</tr>
<tr>
<td>eqz</td>
<td>6</td>
<td>if( src == 0 ) goto imm</td>
</tr>
<tr>
<td>nez</td>
<td>7</td>
<td>if( src != 0 ) goto imm</td>
</tr>
<tr>
<td>ltz</td>
<td>8</td>
<td>if( src &lt; 0 ) goto imm</td>
</tr>
<tr>
<td>lez</td>
<td>9</td>
<td>if( src &lt;= 0 ) goto imm</td>
</tr>
<tr>
<td>gtz</td>
<td>10</td>
<td>if( src &gt; 0 ) goto imm</td>
</tr>
<tr>
<td>gez</td>
<td>11</td>
<td>if( src &gt;= 0 ) goto imm</td>
</tr>
</tbody>
</table>
<p><strong>注意</strong>： 和 0 比较时，无源操作数 src2。</p>
<h5 id="类型码">类型码</h5>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作子码</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>int32</td>
<td>0</td>
<td>32 位有符号比较</td>
</tr>
<tr>
<td>uint32</td>
<td>1</td>
<td>32 位无符号比较</td>
</tr>
<tr>
<td>int64</td>
<td>2</td>
<td>64 位有符号比较</td>
</tr>
<tr>
<td>uint64</td>
<td>3</td>
<td>64 位无符号比较</td>
</tr>
<tr>
<td>flt32</td>
<td>4</td>
<td>32 位浮点数比较</td>
</tr>
<tr>
<td>flt64</td>
<td>5</td>
<td>64 位浮点数比较</td>
</tr>
</tbody>
</table>
<h3 id="返回指令">返回指令</h3>
<p>文本格式： op src
op imm</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>操作子码</th>
<th>立即数码</th>
<th>源操作数</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td></td>
<td></td>
<td>8 bit</td>
<td>指令宽度： 16 bit</td>
</tr>
<tr>
<td>return-void</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>无参数返回</td>
</tr>
<tr>
<td>return-w32-I8</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>返回 32 bit 值</td>
</tr>
<tr>
<td>return-w64-I8</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>返回 64 bit 值</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>4 bit</td>
<td>4 bit</td>
<td>16/32/64 bit</td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="操作子码-1">操作子码</h5>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作子码</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>I16</td>
<td>0</td>
<td>寄存器索引16位</td>
</tr>
<tr>
<td>int32</td>
<td>1</td>
<td>立即数转换到32位有符号整数</td>
</tr>
<tr>
<td>uint32</td>
<td>2</td>
<td>立即数转换到32位有符号整数</td>
</tr>
<tr>
<td>int64</td>
<td>3</td>
<td>立即数转换到32位有符号整数</td>
</tr>
<tr>
<td>uint64</td>
<td>4</td>
<td>立即数转换到32位有符号整数</td>
</tr>
<tr>
<td>flt32</td>
<td>5</td>
<td>立即数转换到32位有符号整数</td>
</tr>
<tr>
<td>flt64</td>
<td>6</td>
<td>立即数转换到32位有符号整数</td>
</tr>
</tbody>
</table>
<h5 id="立即数码">立即数码</h5>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作子码</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>B16</td>
<td>0</td>
<td>16 位立即数</td>
</tr>
<tr>
<td>B32</td>
<td>1</td>
<td>32 位立即数</td>
</tr>
<tr>
<td>B64</td>
<td>2</td>
<td>64 位立即数</td>
</tr>
</tbody>
</table>
<h3 id="函数调用指令">函数调用指令</h3>
<h4 id="不固定参数调用">不固定参数调用</h4>
<p>文本格式：op argcnt, arg,arg2,&hellip;,func</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>参数个数</th>
<th>参数寄存器</th>
<th>函数</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>32 bit</td>
<td></td>
</tr>
<tr>
<td>invoke-virtual-nofix</td>
<td></td>
<td>argcnt</td>
<td>arg&hellip;</td>
<td>func</td>
<td>调用虚函数</td>
</tr>
<tr>
<td>invoke-direct-nofix</td>
<td></td>
<td>argcnt</td>
<td>arg&hellip;</td>
<td>func</td>
<td>直接调用函数</td>
</tr>
<tr>
<td>invoke-static-nofix</td>
<td></td>
<td>argcnt</td>
<td>arg&hellip;</td>
<td>func</td>
<td>调用静态函数</td>
</tr>
<tr>
<td>invoke-interface-nofix</td>
<td></td>
<td>argcnt</td>
<td>arg&hellip;</td>
<td>func</td>
<td>调用接口函数</td>
</tr>
<tr>
<td>invoke-native-nofix</td>
<td></td>
<td>argcnt</td>
<td>arg&hellip;</td>
<td>func</td>
<td>调用C语言函数</td>
</tr>
</tbody>
</table>
<h4 id="范围参数调用">范围参数调用</h4>
<p>文本格式：op argcnt,start, end,func</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>参数个数</th>
<th>起始寄存器</th>
<th>结束寄存器索引</th>
<th>函数</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>16 bit</td>
<td>32 bit</td>
<td></td>
</tr>
<tr>
<td>invoke-virtual-range</td>
<td></td>
<td>argcnt</td>
<td>arg&hellip;</td>
<td>func</td>
<td>调用虚函数</td>
<td></td>
</tr>
<tr>
<td>invoke-direct-range</td>
<td></td>
<td>argcnt</td>
<td>arg&hellip;</td>
<td>func</td>
<td>直接调用函数</td>
<td></td>
</tr>
<tr>
<td>invoke-static-range</td>
<td></td>
<td>argcnt</td>
<td>arg&hellip;</td>
<td>func</td>
<td>调用静态函数</td>
<td></td>
</tr>
<tr>
<td>invoke-interface-range</td>
<td></td>
<td>argcnt</td>
<td>arg&hellip;</td>
<td>func</td>
<td>调用接口函数</td>
<td></td>
</tr>
<tr>
<td>invoke-native-range</td>
<td></td>
<td>argcnt</td>
<td>arg&hellip;</td>
<td>func</td>
<td>调用C语言函数</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="获取返回值指令">获取返回值指令</h3>
<p>文本格式：op des</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>对齐</th>
<th>源寄存器</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td></td>
<td>8 bit</td>
<td>指令宽度： 16 bit</td>
</tr>
<tr>
<td>get-result-w32-I8</td>
<td></td>
<td></td>
<td>des</td>
<td>获取32位返回值</td>
</tr>
<tr>
<td>get-result-w64-I8</td>
<td></td>
<td></td>
<td>des</td>
<td>获取64位返回值</td>
</tr>
<tr>
<td>get-result-obj-I8</td>
<td></td>
<td></td>
<td>des</td>
<td>获取对象返回值</td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>指令宽度： 32 bit</td>
</tr>
<tr>
<td>get-result-w32-I16</td>
<td></td>
<td></td>
<td>des</td>
<td>获取32位返回值</td>
</tr>
<tr>
<td>get-result-w64-I16</td>
<td></td>
<td></td>
<td>des</td>
<td>获取64位返回值</td>
</tr>
<tr>
<td>get-result-obj-I16</td>
<td></td>
<td></td>
<td>des</td>
<td>获取对象返回值</td>
</tr>
</tbody>
</table>
<h3 id="异常处理指令">异常处理指令</h3>
<p>文本格式：op des</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>对齐</th>
<th>源寄存器</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>8 bit</td>
<td></td>
<td>8 bit</td>
<td>指令宽度： 16 bit</td>
</tr>
<tr>
<td>get-exception-I8</td>
<td></td>
<td></td>
<td>des</td>
<td>获取异常对象</td>
</tr>
<tr>
<td>throw-I8</td>
<td></td>
<td>src</td>
<td>抛出异常对象</td>
<td></td>
</tr>
<tr>
<td></td>
<td>8 bit</td>
<td>8 bit</td>
<td>16 bit</td>
<td>指令宽度： 32 bit</td>
</tr>
<tr>
<td>get-exception-I16</td>
<td></td>
<td></td>
<td>des</td>
<td>获取异常对象</td>
</tr>
<tr>
<td>throw-I16</td>
<td></td>
<td>src</td>
<td>抛出异常对象</td>
<td></td>
</tr>
</tbody>
</table>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="3-基于栈和寄存器的指令集">3 基于栈和寄存器的指令集</h1>

<p>本章节描述的是作者按照 RISC 指令系统设计的虚拟机指令集。</p>
<p>其类似与硬件指令集，可作为编译器后端指令系统目标，用于提供类似硬件指令系统环境，避免编译原理初学者陷入对硬件指令系统不了解的深渊。
降低学习难度，提高学习效率。</p>
<p>这类指令的主要特点如下：</p>
<ul>
<li>1 寄存器的数量固定；</li>
<li>2 指令所操作的寄存器数量固定；</li>
<li>3 指令的含义简单；</li>
</ul>
<h2 id="1-寄存器">1 寄存器</h2>
<p>虚拟机的寄存器分为三种：</p>
<ul>
<li>1 整数寄存器：主要用于整数运算，位宽为 64 bit，根据指令的含义可选择 32 bit 和 64 bit 运算模式。</li>
<li>2 浮点寄存器：主要用于浮点数运算，位宽为 64 bit，和通用寄存器一致，可选择位宽模式。</li>
<li>3 系统寄存器：对用户不可见，与虚拟机运行系统相关，对其进行操作隐藏在相关指令的实现细节中。</li>
<li>4 根据指令格式，整数寄存器、浮点寄存器最多可以有32个。</li>
</ul>
<h2 id="2-指令格式">2 指令格式</h2>
<p>每条指令是 32bit 大小对齐的，其中最低 9bit 是操作码，其余23bit作为操作数或者操作码的补充。如下表所示：</p>
<table>
<thead>
<tr>
<th>操作码</th>
<th>操作数</th>
</tr>
</thead>
<tbody>
<tr>
<td>9 bit</td>
<td>23 bit</td>
</tr>
</tbody>
</table>
<h3 id="21-格式1">2.1 格式1</h3>
<table>
<thead>
<tr>
<th>操作码</th>
<th>操作数</th>
</tr>
</thead>
<tbody>
<tr>
<td>9 bit</td>
<td>23 bit</td>
</tr>
</tbody>
</table>
<h3 id="22-格式2">2.2 格式2</h3>
<p>多数指令使用此格式。</p>
<table>
<thead>
<tr>
<th>操作码</th>
<th>目的操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>操作子码</th>
</tr>
</thead>
<tbody>
<tr>
<td>9 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>8 bit</td>
</tr>
</tbody>
</table>
<h3 id="23-格式3">2.3 格式3</h3>
<p>该格式主要用于比较指令后的三元选择赋值操作。</p>
<table>
<thead>
<tr>
<th>操作码</th>
<th>目的操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>操作子码</th>
</tr>
</thead>
<tbody>
<tr>
<td>9 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>3 bit</td>
</tr>
</tbody>
</table>
<h3 id="24-格式4">2.4 格式4</h3>
<p>当指令中需要使用立即数时，且在指令中没有足够的空间可以存储时，可以使用指令后跟32bit对齐的立即数操作数。</p>
<ul>
<li>32bit立即数：32bit 指令跟 1 个 32bit 立即数，虚拟机解析执行时，按照指令表达的语义参与运算。</li>
<li>64bit立即数：32bit 指令跟 2 个 32bit 立即数，虚拟机解析执行时，按照指令表达的语义，组合成 64bit，后参与运算。</li>
<li>其他位宽的立即数类似。</li>
</ul>
<p>格式如下所示：</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>立即数 1</th>
<th>立即数 2</th>
<th>&hellip;</th>
<th>立即数 n</th>
</tr>
</thead>
<tbody>
<tr>
<td>32 bit</td>
<td>32 bit</td>
<td>32 bit</td>
<td>&hellip;</td>
<td>32 bit</td>
</tr>
</tbody>
</table>
<h2 id="3-寄存器与寄存器---指令集">3 寄存器与寄存器&mdash;指令集</h2>
<h3 id="31-空指令">3.1 空指令</h3>
<p>空指令一般用于对齐，在本指令集中没有特殊含义，执行空操作。</p>
<p>格式如下：</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>操作数</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>23 bit</td>
</tr>
<tr>
<td>Nop</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<h3 id="32-算术运算">3.2 算术运算</h3>
<p>算术运算包含 +、-、*、/、%，支持的运算类型有 int32、uint32、int64、uint64、flt32、flt64。</p>
<ul>
<li>文本格式： op des,src,src2</li>
<li>指令含义：des = src op src2</li>
<li>子操作码：可以用于将运算结果进行截断、扩展。</li>
<li>助记符后缀的数字(32、64)标识指令运算使用的寄存器位宽。</li>
<li>助记符后缀的 i 表示进行有符号运算。</li>
<li>助记符后缀的 u 表示进行无符号运算。</li>
<li>助记符后缀的 f 表示进行有符号运算。</li>
</ul>
<p>指令格式如下所示：</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>操作子码</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>8 bit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>sub-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>mul-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>div-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>mod-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-u32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>sub-u32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>mul-u32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>div-u32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>mod-u32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>sub-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>mul-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>div-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>mod-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-u64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>sub-u64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>mul-u64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>div-u64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>mod-u64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-f32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>sub-f32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>mul-f32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>div-f32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>add-f64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>sub-f64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>mul-f64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>div-f64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="32-位运算">3.2 位运算</h3>
<p>位运算包括位相关的与、或、非、异或、移位、取反等运算。</p>
<p>支持的运算类型有 uint32、uint64。</p>
<ul>
<li>文本格式： op des,src,src2</li>
<li>指令含义：des = src op src2</li>
<li>子操作码：可以用于将运算结果进行截断、扩展。</li>
<li>i32：表示进行 32bit 的位运算。</li>
<li>i64：表示进行 64bit 的位运算。</li>
<li>位运算都是看作无符号运算。</li>
</ul>
<p>指令格式如下所示：</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>操作子码</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>8 bit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>sl-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>sr-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>sra-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>and-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>or-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>xor-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>andn-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>orn-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>xorn-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>not-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>sl-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>sr-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>sra-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>and-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>or-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>xor-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>andn-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>orn-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>xorn-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>not-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="33-逻辑比较">3.3 逻辑比较</h3>
<p>逻辑比较运算包括：&lt;、&gt;、&lt;=、&gt;=、==、!=、 ==0、！=0.
支持的运算类型有 int32、uint32、int64、uint64、flt32\flt64。</p>
<ul>
<li>文本格式： op des,src,src2</li>
<li>指令含义：des = src op src2</li>
<li>子操作码：可以用于标识比较的方法。</li>
<li>比较的结果，存储在整数寄存器中，且使用位宽 64 bit，即des是整数寄存器。</li>
</ul>
<p>指令格式如下所示：</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>操作子码</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>8 bit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>cmp-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>cmp-u32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>cmp-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>cmp-u64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>cmp-f32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
<tr>
<td>cmp-f64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td></td>
</tr>
</tbody>
</table>
<p>操作子码定义如下：</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>lt</td>
<td></td>
<td>&lt;</td>
</tr>
<tr>
<td>le</td>
<td></td>
<td>&lt;=</td>
</tr>
<tr>
<td>gt</td>
<td></td>
<td>&gt;</td>
</tr>
<tr>
<td>ge</td>
<td></td>
<td>&gt;=</td>
</tr>
<tr>
<td>eq</td>
<td></td>
<td>==</td>
</tr>
<tr>
<td>ne</td>
<td></td>
<td>!=</td>
</tr>
<tr>
<td>ez</td>
<td></td>
<td>==0，此时没有源操作数src2</td>
</tr>
<tr>
<td>nz</td>
<td></td>
<td>!=0，此时没有源操作数src2</td>
</tr>
</tbody>
</table>
<p>当不使用操作子码，而是使用下面方式运算：</p>
<ul>
<li>src &lt; src2，设置des寄存器为 -1。</li>
<li>src == src2，设置des寄存器为 0。</li>
<li>src &gt; src2，设置des寄存器为 -1。</li>
</ul>
<h3 id="34-条件赋值">3.4 条件赋值</h3>
<p>条件赋值指令使用比较指令的结果，对另外 2 个源操作数进行选择，传递个目标操作数。</p>
<p>指令格式如下所示：</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>操作子码</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>3 bit</td>
</tr>
<tr>
<td>sel-i32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td>cond</td>
<td></td>
</tr>
<tr>
<td>sel-u32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td>cond</td>
<td></td>
</tr>
<tr>
<td>sel-i64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td>cond</td>
<td></td>
</tr>
<tr>
<td>sel-u64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td>cond</td>
<td></td>
</tr>
<tr>
<td>sel-f32</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td>cond</td>
<td></td>
</tr>
<tr>
<td>sel-f64</td>
<td></td>
<td>des</td>
<td>src</td>
<td>src2</td>
<td>cond</td>
<td></td>
</tr>
</tbody>
</table>
<p>当比较系列指令使用操作子码方式时：</p>
<ul>
<li>cond == 0 ：des = src</li>
<li>cond != 0 ：des = src2</li>
</ul>
<p>当比较系列指令不使用操作子码方式时，本系列指令要求使用操作子码进行判断：</p>
<p>操作子码定义如下：</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>lt</td>
<td></td>
<td>&lt;  ：des = cond == -1 ? src : src2</td>
</tr>
<tr>
<td>le</td>
<td></td>
<td>&lt;= ：des = cond &lt; 1 ? src : src2</td>
</tr>
<tr>
<td>gt</td>
<td></td>
<td>&gt;  ：des = cond == 1 ? src : src2</td>
</tr>
<tr>
<td>ge</td>
<td></td>
<td>&gt;= ：des = cond &gt; -1 ? src : src2</td>
</tr>
<tr>
<td>eq</td>
<td></td>
<td>== ：des = cond == 0 ? src : src2</td>
</tr>
<tr>
<td>ne</td>
<td></td>
<td>!= ：des = cond != 0 ? src : src2</td>
</tr>
</tbody>
</table>
<h3 id="35-赋值指令">3.5 赋值指令</h3>
<p>此系列包括寄存器间赋值或类型转换。</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>操作子码</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>8 bit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>mov</td>
<td></td>
<td>des</td>
<td>src</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>操作子码用于获取源操作数并转换到响应的类型。</p>
<p>操作子码定义如下：</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>i8-i32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u8-i32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>i8-i64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u8-u64</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>i16-i32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u16-i32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>i16-i64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u16-i64</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>i32_i32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>i32-i64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>i32-f32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>i32-f64</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>u32-u32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u32-u64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u32-f32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u32-f64</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>i64-i64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>i64-f32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>i64-f64</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>u64-u64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u64-f32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u64-f64</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>f32-i32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f32-u32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f32-i64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f32-u64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f32-f32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f32-f64</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>f64-i32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f64-u32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f64-i64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f64-u64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f64-f32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f64-f64</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>f32-bit-u32</td>
<td></td>
<td>位转换</td>
</tr>
<tr>
<td>u32-bit-f32</td>
<td></td>
<td>位转换</td>
</tr>
<tr>
<td>f64-bit-u64</td>
<td></td>
<td>位转换</td>
</tr>
<tr>
<td>u64-bit-f64</td>
<td></td>
<td>位转换</td>
</tr>
</tbody>
</table>
<h3 id="36-加载存储指令">3.6 加载存储指令</h3>
<p>此系列指令功能是从内存中读取、存储特定类型数据。</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>操作子码</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>8 bit</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>load</td>
<td></td>
<td>des</td>
<td>base</td>
<td>offset</td>
<td></td>
<td>从基址内存中获取数据</td>
</tr>
<tr>
<td>store</td>
<td></td>
<td>des</td>
<td>base</td>
<td>offset</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>gload</td>
<td></td>
<td>des</td>
<td>base</td>
<td>offset</td>
<td></td>
<td>从全局内存中获取数据</td>
</tr>
<tr>
<td>gstore</td>
<td></td>
<td>des</td>
<td>base</td>
<td>offset</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>操作子码定义如下：</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>i8</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u8</td>
<td></td>
<td></td>
</tr>
<tr>
<td>i16</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u16</td>
<td></td>
<td></td>
</tr>
<tr>
<td>i32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>i64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>u64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>f64</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="37-出入栈指令">3.7 出入栈指令</h3>
<p>此系列指令用于将数据入栈，同时可以进行类型转换。
注意：入栈数据应当进行 32bit 对齐。以加快虚拟机执行速度数据</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>操作子码</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>8 bit</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>push</td>
<td></td>
<td>des</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>pop</td>
<td></td>
<td>des</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>操作子码定义如下：</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>助记符</td>
<td>操作码</td>
<td>含义</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>&mdash;</td>
<td>&mdash;</td>
<td>&mdash;</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>i8</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>u8</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>i16</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>u16</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>i32</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>u32</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>i64</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>u64</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>f32</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>f64</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="38-栈内存分配释放">3.8 栈内存分配释放</h3>
<p>此系列指令用于栈内存分配释放。
注意：立即数是无符号整数。</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>立即数</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>18 bit</td>
<td></td>
</tr>
<tr>
<td>grown</td>
<td></td>
<td>des</td>
<td>imm</td>
<td>分配栈内存，将分配后的栈指针值传递到 des 寄存器</td>
</tr>
<tr>
<td></td>
<td>9 bit</td>
<td>23 bit</td>
<td>释放栈内存，</td>
<td></td>
</tr>
<tr>
<td>shrunk</td>
<td></td>
<td>imm</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="39-跳转指令">3.9 跳转指令</h3>
<ul>
<li>跳转的偏移量是无符号整数值；</li>
<li>相对于函数代码的起始地址；</li>
<li>偏移量是偏移的指令条数；</li>
</ul>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>立即数</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>23 bit</td>
<td></td>
<td></td>
</tr>
<tr>
<td>jmp</td>
<td></td>
<td>imm</td>
<td></td>
<td>直接跳转</td>
</tr>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>18 bit</td>
<td></td>
</tr>
<tr>
<td>jmpx</td>
<td></td>
<td>reg</td>
<td></td>
<td>偏移量在 reg 寄存器中</td>
</tr>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>18 bit</td>
<td></td>
</tr>
<tr>
<td>jtab</td>
<td></td>
<td>reg</td>
<td>imm</td>
<td>reg 表示偏移量索引，imm表示偏移量数组中偏移数据条数，指令后面接 32 bit 对齐的偏移量数组</td>
</tr>
</tbody>
</table>
<h3 id="310-分支指令">3.10 分支指令</h3>
<p>此系列指令用于条件分支跳转。</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>源操作数</th>
<th>源操作数</th>
<th>操作子码</th>
<th>偏移立即数</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>5 bit</td>
<td>8 bit</td>
<td>32 bit</td>
</tr>
<tr>
<td>jbr-i32</td>
<td></td>
<td>src</td>
<td>src2</td>
<td></td>
<td>cond</td>
<td>offset</td>
</tr>
<tr>
<td>jbr-u32</td>
<td></td>
<td>src</td>
<td>src2</td>
<td></td>
<td>cond</td>
<td>offset</td>
</tr>
<tr>
<td>jbr-i64</td>
<td></td>
<td>src</td>
<td>src2</td>
<td></td>
<td>cond</td>
<td>offset</td>
</tr>
<tr>
<td>jbr-u64</td>
<td></td>
<td>src</td>
<td>src2</td>
<td></td>
<td>cond</td>
<td>offset</td>
</tr>
<tr>
<td>jbr-f32</td>
<td></td>
<td>src</td>
<td>src2</td>
<td></td>
<td>cond</td>
<td>offset</td>
</tr>
<tr>
<td>jbr-f64</td>
<td></td>
<td>src</td>
<td>src2</td>
<td></td>
<td>cond</td>
<td>offset</td>
</tr>
</tbody>
</table>
<p>操作子码定义如下：</p>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>lt</td>
<td></td>
<td>&lt;</td>
</tr>
<tr>
<td>le</td>
<td></td>
<td>&lt;=</td>
</tr>
<tr>
<td>gt</td>
<td></td>
<td>&gt;</td>
</tr>
<tr>
<td>ge</td>
<td></td>
<td>&gt;=</td>
</tr>
<tr>
<td>eq</td>
<td></td>
<td>==</td>
</tr>
<tr>
<td>ne</td>
<td></td>
<td>!=</td>
</tr>
<tr>
<td>ez</td>
<td></td>
<td>==0，此时没有源操作数src2</td>
</tr>
<tr>
<td>nz</td>
<td></td>
<td>!=0，此时没有源操作数src2</td>
</tr>
</tbody>
</table>
<h3 id="311-函数指令">3.11 函数指令</h3>
<table>
<thead>
<tr>
<th>助记符</th>
<th>操作码</th>
<th>目的操作数</th>
<th>立即数</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>9 bit</td>
<td>23 bit</td>
<td>32 bit</td>
<td></td>
</tr>
<tr>
<td>call</td>
<td></td>
<td></td>
<td>imm</td>
<td>imm表示函数的偏移量或者是编号，看虚拟机的具体实现</td>
</tr>
<tr>
<td></td>
<td>9 bit</td>
<td>5 bit</td>
<td>18 bit</td>
<td></td>
</tr>
<tr>
<td>callx</td>
<td></td>
<td>reg</td>
<td></td>
<td>reg 寄存器中保存函数的偏移量或者是编号，看虚拟机的具体实现</td>
</tr>
<tr>
<td></td>
<td>9 bit</td>
<td>23 bit</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ret</td>
<td></td>
<td></td>
<td></td>
<td>函数返回</td>
</tr>
</tbody>
</table>
<h2 id="4-寄存器与立即数--指令集">4 寄存器与立即数&ndash;指令集</h2>
<p>待续</p>

            <footer class="footline">

            </footer>
          </article>

          </section>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第8章</div>
<h1 id="8-语言定义">8 语言定义</h1>

<p>air语言是C语法系的编程语言，提供面向对象、函数式、模板等高级语言功能。</p>
<h2 id="目录">目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./3_compiler/8_langdef/1_langdef/index.html">1 语法定义</a></li>
<li><a href="./3_compiler/8_langdef/2_codefile/index.html">2 代码结构</a></li>
<li><a href="./3_compiler/8_langdef/3_keyword/index.html">3 关键字</a></li>
<li><a href="./3_compiler/8_langdef/4_operator/index.html">4 操作符</a></li>
<li><a href="./3_compiler/8_langdef/5_typesystem/index.html">5 类型系统</a></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">8 语言定义 的子部分</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="1-语法定义">1 语法定义</h1>

<p>语法使用非严格的EBNF语法描述。</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>文件单元
FileUnit = PkgDef (ImportDef) Decl*

包定义
PkgDef = package ID (.ID)*

依赖导入(可选)
ImportDef = &#39;import&#39; STRING as ID; |&#39;{&#39; (STRING as ID; )* &#39;}&#39;
声明定义
Decl = ScopeDecl | VarDecl | FuncDecl | EnumDecl | StructDecl | UnionDecl | InterfaceDecl | ClassDecl | EntrustDecl | ~

表达式
Exp = BaseExp | DotExp | UnaryExp | BinaryExp | TernaryExp | NewExp | PriorityExp

基础表达式
BaseExp = IDExp | ConstExp | CallExp | ArrarExp | ThisExp | SuperExp
IDExp = ID
ConstExp = c
CallExp = ID &#39;(&#39; ArgList&#39;)&#39;
ArrarExp = ID &#39;[&#39; Exp &#39;]&#39;
ThisExp = &#39;this&#39;
SuperExp = &#39;super&#39;

成员访问表达式
DotExp = BaseExp ( &#39;.&#39; BaseExp)*  //BaseExp不得是ConstExp

一元表达式
UnaryExp = UnaryOP BaseExp
UnaryOP = &#39;-&#39; | &#39;+&#39; | &#39;--&#39; | &#39;++&#39; | &#39;~&#39; | &#39;!&#39;
二元表达式
BinaryExp = Exp BinaryOP Exp
BinaryOP = &#39;+&#39; | &#39;-&#39; | &#39;*&#39; | &#39;/&#39; | &#39;%&#39; |
            &#39;&amp;&#39; | &#39;|&#39; | &#39;&amp;&amp;&#39; | &#39;||&#39; |
            &#39;&lt;&lt;&#39; | &#39;&gt;&gt;&#39; | &#39;&gt;&gt;&gt;&#39; |
            &#39;&lt;&#39; | &#39;&gt;&#39; | &#39;&lt;=&#39; | &#39;&gt;=&#39; |
            &#39;==&#39; | &#39;!=&#39; | &#39;=&#39; |
            
三元表达式
TernaryExp = Exp &#39;?&#39; Exp &#39;:&#39; Exp

括号表达式
PriorityExp = &#39;(&#39; Exp &#39;)&#39;

作用域声明
ScopeDecl = ( &#39;public&#39; | &#39;protected&#39; | &#39;private&#39; ) &#39;:&#39;

变量声明
VarDecl = Scope Type &#39;id&#39; [=initExp] &#39;;&#39;
Scope = [&#39;public&#39; | &#39;protected&#39; | &#39;private&#39;| &#39;extern&#39; | &#39;static&#39;] 
Type = [&#39;const&#39; ] &#39;id&#39;( &#39;.&#39; &#39;id&#39;)*

代理变量
Scope Type &#39;id&#39;&#39;(&#39; [ arglist] &#39;)&#39; &#39;delegate&#39; &#39;;&#39;

闭包变量
Scope Type &#39;id&#39;&#39;(&#39; [ arglist] &#39;)&#39; &#39;closure&#39; &#39;;&#39;

函数申明
VarDecl = Scope Type &#39;id&#39;&#39;(&#39; [ arglist] &#39;)&#39;[@override] [@cfun] [const] [final] (&#39;;&#39; |  funbody )
arglist = argitem (&#39;,&#39; argitem)*
argitem = type [&#39;id&#39;]
funbody = BlkState
BlkState = &#39;{&#39; [Statement] &#39;}&#39;
Statement = ( BlkState | ExpState | IfState | ElseifState |
			ElseState | SwitchState | ForState | DoState |
			WhileState | GotoState | BreakState | ContinueState |
			ReturnState )*
	

TypeDecl = EnumDecl | StructDecl |  UnionDecl |EntrustDecl
FuncDecl = Type &#39;id&#39;&#39;(&#39; [ arglist] &#39;)&#39; &#39;=&#39; Serial
	Serial = &#39;u32&#39;
	枚举声明
	EnumDecl = &#39;enum&#39; id [: BaseType]&#39;{&#39; EnumItem* &#39;}&#39;
	BaseType = 基本整数类型
	EnumItem = &#39;id&#39;[=initExp] &#39;,&#39;</code></pre></div>
            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="2-代码结构">2 代码结构</h1>

<p>每一个文件都必须定义一个作用域名，其他内容在此作用域定义。</p>
<p>生成的声明符号都在该作用域内，只能通过该作用域才能访问代码文件中声明的符号内容。</p>
<h2 id="代码结构">代码结构</h2>
<h3 id="包声明">包声明</h3>
<pre><code>package pkg.pkg2;
</code></pre>
<h3 id="依赖单元">依赖单元</h3>
<pre><code>Import file=“dir/file.ext” as file ;
</code></pre>
<p>或者</p>
<pre><code>Import{

	 ile=“dir/file.ext” as file ;
	 ile2=“dir/file2.ext” as file2  ;
}
</code></pre>
<h3 id="枚举定义">枚举定义</h3>
<pre><code>enum name : int32{
    item=0,
    item2=23,
    …
}
</code></pre>
<h3 id="结构体定义">结构体定义</h3>
<pre><code>Struct name{
	Int32 i32;
	Union{
		Int32 s32;
		Flt32 f32;
    }
}
</code></pre>
<h3 id="联合体定义">联合体定义</h3>
<pre><code>Union name{
	Int32 s32;
	Flt32 f32;
	Struct{…}
}
</code></pre>
<h3 id="接口定义">接口定义</h3>
<pre><code>Interface IFather{
    void eat(int32 arg);
}
Interface IFather2{
    void say(int32 arg);
}
Interface IChild :[ IFather,IFather2 ]{
    void walk(int32 arg);
}
</code></pre>
<h3 id="类定义">类定义</h3>
<pre><code>Class Parent {
Private:
        Int32 mI32;
Public	Flt32 mF32;
Public:
    Void print(){}
Protected void toString(){}
    Virtual void vfun()=0;
}

Class child: Parent :[ IChild ]{
    void eat(int32 arg) @override{}
    void say(int32 arg) @override{}
    void walk(int32 arg) @override{}
    void vfun()@override{}
}</code></pre>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="3-关键字">3 关键字</h1>

<p>airlang 的关键字分为两种：普通关键字，宏关键字。
两者差别不大，但是宏关键字有特殊的标记作用，一般用于注解一些信息。</p>
<h2 id="宏关键字">宏关键字</h2>
<table>
<thead>
<tr>
<th>关键字</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>@file</td>
<td>代码中获取文件的名称字符串</td>
</tr>
<tr>
<td>@line</td>
<td>代码中获取代码所作行号数字</td>
</tr>
<tr>
<td>@func</td>
<td>代码中获取函数声明字符串</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>@debug</td>
<td>用于标记只在debug标志下启用的代码</td>
</tr>
<tr>
<td>@NotNulptr</td>
<td>用于标记需要检查函数的指针参数非空</td>
</tr>
<tr>
<td>@override</td>
<td>标记非静态成员函数是重写父类的函数</td>
</tr>
</tbody>
</table>
<h2 id="普通关键字">普通关键字</h2>
<table>
<thead>
<tr>
<th>固定位宽类型关键字</th>
<th>注解</th>
<th>位宽(bit)</th>
</tr>
</thead>
<tbody>
<tr>
<td>void</td>
<td>空，一般用于表示无返回值</td>
<td>0</td>
</tr>
<tr>
<td>bool</td>
<td>布尔类型</td>
<td>8</td>
</tr>
<tr>
<td>flt32</td>
<td>32位单精度浮点</td>
<td>32</td>
</tr>
<tr>
<td>flt64</td>
<td>64位双精度浮点</td>
<td>32</td>
</tr>
<tr>
<td>int8</td>
<td>8位有符号整数</td>
<td>8</td>
</tr>
<tr>
<td>int16</td>
<td>8位有符号整数</td>
<td>16</td>
</tr>
<tr>
<td>int32</td>
<td>8位有符号整数</td>
<td>32</td>
</tr>
<tr>
<td>int64</td>
<td>8位有符号整数</td>
<td>64</td>
</tr>
<tr>
<td>uint8</td>
<td>8位无符号整数</td>
<td>8</td>
</tr>
<tr>
<td>uint16</td>
<td>16位无符号整数</td>
<td>16</td>
</tr>
<tr>
<td>uint32</td>
<td>32位无符号整数</td>
<td>32</td>
</tr>
<tr>
<td>uint64</td>
<td>64位无符号整数</td>
<td>64</td>
</tr>
<tr>
<td>char</td>
<td>字符</td>
<td>8</td>
</tr>
</tbody>
</table>
<p>可变位宽类型的位宽由编译的目标CPU架构有关。</p>
<table>
    <th>可变位宽类型关键字</th><th>注解</th><th>CPU32</th><th>CPU64</th>
    <tr>
    <td>sint</td><td>有符号整数 </td><td>32</td><td>64</td>
    </tr>
    <tr>
    <td>uint</td><td>无符号整数 </td><td>32</td><td>64</td>
    </tr>
    <tr>
    <td>uintptr</td><td>指针 </td><td>32</td><td>64</td>
    </tr>
    <tr>
    <td>cstring</td><td>字符串指针 </td><td>32</td><td>64</td>
    </tr>
</table>
<table>
<thead>
<tr>
<th>修饰关键字</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>static</td>
<td>静态</td>
</tr>
<tr>
<td>public</td>
<td>完全公开的</td>
</tr>
<tr>
<td>protected</td>
<td>对部分成员公开的</td>
</tr>
<tr>
<td>private</td>
<td>私有的 成员</td>
</tr>
<tr>
<td>const</td>
<td>常量化，只读</td>
</tr>
<tr>
<td>friend</td>
<td>友元定义</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>分支关键字</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>if</td>
<td>比较分支</td>
</tr>
<tr>
<td>elsif</td>
<td>次比较分支</td>
</tr>
<tr>
<td>else</td>
<td>比较默认分支</td>
</tr>
<tr>
<td>for</td>
<td>循环</td>
</tr>
<tr>
<td>foreach</td>
<td>循环</td>
</tr>
<tr>
<td>while</td>
<td>循环</td>
</tr>
<tr>
<td>do</td>
<td>循环</td>
</tr>
<tr>
<td>break</td>
<td>跳出循环</td>
</tr>
<tr>
<td>continue</td>
<td>继续下一轮循环</td>
</tr>
<tr>
<td>goto</td>
<td>跳转到标签</td>
</tr>
<tr>
<td>return</td>
<td>函数返回</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>类型定义关键字</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>enum</td>
<td>枚举</td>
</tr>
<tr>
<td>struct</td>
<td>结构体</td>
</tr>
<tr>
<td>union</td>
<td>联合体</td>
</tr>
<tr>
<td>interface</td>
<td>接口</td>
</tr>
<tr>
<td>class</td>
<td>类</td>
</tr>
<tr>
<td>entrust</td>
<td>委托指针</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>其他关键字</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>false</td>
<td></td>
</tr>
<tr>
<td>true</td>
<td></td>
</tr>
<tr>
<td>nullptr</td>
<td></td>
</tr>
<tr>
<td>this</td>
<td></td>
</tr>
<tr>
<td>super</td>
<td></td>
</tr>
</tbody>
</table>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="4-操作符">4 操作符</h1>

<h2 id="成员访问操作符">成员访问操作符</h2>
<p>成员访问操作符的优先级最高。</p>
<table>
<thead>
<tr>
<th>成员访问操作符</th>
<th>优先级</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>.</td>
<td>0</td>
<td>成员访问</td>
</tr>
<tr>
<td>.?</td>
<td>0</td>
<td>带null检查的成员访问</td>
</tr>
</tbody>
</table>
<h2 id="一元操作符">一元操作符</h2>
<p>一元操作符优先级一致，主要查看其声明的先后顺序。</p>
<table>
<thead>
<tr>
<th>一元操作符</th>
<th>优先级</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>~</td>
<td>-10</td>
<td>按位取反</td>
</tr>
<tr>
<td>!</td>
<td>-10</td>
<td>逻辑取反</td>
</tr>
<tr>
<td>-</td>
<td>-10</td>
<td>符号取反</td>
</tr>
<tr>
<td>+</td>
<td>-10</td>
<td>取绝对值</td>
</tr>
<tr>
<td>++</td>
<td>-10</td>
<td>自增</td>
</tr>
<tr>
<td>--</td>
<td>-10</td>
<td>自减</td>
</tr>
</tbody>
</table>
<h2 id="二元操作符">二元操作符</h2>
<p>在语法解析表达式中，二元表达式最复杂的。</p>
<table>
<thead>
<tr>
<th>二元操作符</th>
<th>优先级</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>-20</td>
<td>乘运算操作符</td>
</tr>
<tr>
<td>/</td>
<td>-20</td>
<td>除运算操作符</td>
</tr>
<tr>
<td>%</td>
<td>-20</td>
<td>模运算操作符</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>+</td>
<td>-30</td>
<td>加运算操作符</td>
</tr>
<tr>
<td>-</td>
<td>-30</td>
<td>减运算操作符</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>&lt;&lt;</td>
<td>-40</td>
<td>左移操作符</td>
</tr>
<tr>
<td>&gt;&gt;</td>
<td>-40</td>
<td>逻辑右移操作符</td>
</tr>
<tr>
<td>&gt;&gt;&gt;</td>
<td>-40</td>
<td>算术右移操作符</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>&lt;</td>
<td>-50</td>
<td>小于操作符</td>
</tr>
<tr>
<td>&lt;=</td>
<td>-50</td>
<td>小于等于操作符</td>
</tr>
<tr>
<td>&gt;</td>
<td>-50</td>
<td>大于于操作符</td>
</tr>
<tr>
<td>&gt;=</td>
<td>-50</td>
<td>大于等于操作符</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>==</td>
<td>-60</td>
<td>等于操作符</td>
</tr>
<tr>
<td>!=</td>
<td>-60</td>
<td>不等于操作符</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>&amp;</td>
<td>-70</td>
<td>位与操作符</td>
</tr>
<tr>
<td>^</td>
<td>-71</td>
<td>位异或操作符</td>
</tr>
<tr>
<td>|</td>
<td>-72</td>
<td>位或操作符</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>-80</td>
<td>逻辑与操作符</td>
</tr>
<tr>
<td>||</td>
<td>-81</td>
<td>逻辑或操作符</td>
</tr>
</tbody>
</table>
<h2 id="三元操作符">三元操作符</h2>
<p>三元操作符主要用于比较赋值、简单的比较分支操作。</p>
<table>
<thead>
<tr>
<th>三元操作符</th>
<th>优先级</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>? :</td>
<td>-90</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="赋值操作符">赋值操作符</h2>
<p>赋值类操作符的优先级一致，优先级最低。</p>
<table>
<thead>
<tr>
<th>赋值操作符</th>
<th>优先级</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>=</td>
<td>-100</td>
<td>赋值操作符</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>*=</td>
<td>-100</td>
<td>乘运算复合赋值操作符</td>
</tr>
<tr>
<td>/=</td>
<td>-100</td>
<td>除运算复合赋值操作符</td>
</tr>
<tr>
<td>%=</td>
<td>-100</td>
<td>模运算复合赋值操作符</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>+=</td>
<td>-100</td>
<td>加运算复合赋值操作符</td>
</tr>
<tr>
<td>-=</td>
<td>-100</td>
<td>减运算复合赋值操作符</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>&amp;=</td>
<td>-100</td>
<td>位与运算复合赋值操作符</td>
</tr>
<tr>
<td>=</td>
<td>-100</td>
<td>位或运算复合赋值操作符</td>
</tr>
<tr>
<td>^=</td>
<td>-100</td>
<td>位异或运算复合赋值操作符</td>
</tr>
<tr>
<td>~=</td>
<td>-100</td>
<td>位取反运算复合赋值操作符</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>&lt;&lt;=</td>
<td>-100</td>
<td>左移运算复合赋值操作符</td>
</tr>
<tr>
<td>&gt;&gt;=</td>
<td>-100</td>
<td>逻辑右移运算复合赋值操作符</td>
</tr>
<tr>
<td>&gt;&gt;&gt;=</td>
<td>-100</td>
<td>算术右移运算复合赋值操作符</td>
</tr>
</tbody>
</table>
<h2 id="其他操作符">其他操作符</h2>
<p>括号表达式中的括号操作符，用于提升表达式的优先级，在算符优先解析算法，该系列是作为基本表达式进行解析的。</p>
<table>
<thead>
<tr>
<th>括号操作符</th>
<th>优先级</th>
<th>注解</th>
</tr>
</thead>
<tbody>
<tr>
<td>（）</td>
<td>-10</td>
<td>括号操作符</td>
</tr>
<tr>
<td>[]</td>
<td>-10</td>
<td>数组下标</td>
</tr>
<tr>
<td>cast</td>
<td>-10</td>
<td>静态类型转换</td>
</tr>
<tr>
<td>dyn_cast</td>
<td>-10</td>
<td>动态类型转换</td>
</tr>
<tr>
<td>()</td>
<td>-10</td>
<td>函数调用</td>
</tr>
</tbody>
</table>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="5-类型系统">5 类型系统</h1>

<h2 id="基本类型">基本类型</h2>
<table>
<thead>
<tr>
<th>固定位宽类型</th>
<th>注解</th>
<th>位宽(bit)</th>
</tr>
</thead>
<tbody>
<tr>
<td>void</td>
<td>空，一般用于表示无返回值</td>
<td>&mdash;</td>
</tr>
<tr>
<td>bool</td>
<td>布尔类型</td>
<td>8</td>
</tr>
<tr>
<td>flt32</td>
<td>32位单精度浮点</td>
<td>32</td>
</tr>
<tr>
<td>flt64</td>
<td>64位双精度浮点</td>
<td>32</td>
</tr>
<tr>
<td>int8</td>
<td>8位有符号整数</td>
<td>8</td>
</tr>
<tr>
<td>int16</td>
<td>8位有符号整数</td>
<td>16</td>
</tr>
<tr>
<td>int32</td>
<td>8位有符号整数</td>
<td>32</td>
</tr>
<tr>
<td>int64</td>
<td>8位有符号整数</td>
<td>64</td>
</tr>
<tr>
<td>uint8</td>
<td>8位无符号整数</td>
<td>8</td>
</tr>
<tr>
<td>uint16</td>
<td>16位无符号整数</td>
<td>16</td>
</tr>
<tr>
<td>uint32</td>
<td>32位无符号整数</td>
<td>32</td>
</tr>
<tr>
<td>uint64</td>
<td>64位无符号整数</td>
<td>64</td>
</tr>
<tr>
<td>char</td>
<td>字符</td>
<td>8</td>
</tr>
</tbody>
</table>
<p>可变位宽类型的位宽由编译的目标CPU架构有关。</p>
<table>
    <th>可变位宽类型</th><th>注解</th><th>CPU32</th><th>CPU64</th>
    <tr>
    <td>sint</td><td>有符号整数 </td><td>32</td><td>64</td>
    </tr>
    <tr>
    <td>uint</td><td>无符号整数 </td><td>32</td><td>64</td>
    </tr>
    <tr>
    <td>uintptr</td><td>指针 </td><td>32</td><td>64</td>
    </tr>
    <tr>
    <td>cstring</td><td>字符串指针 </td><td>32</td><td>64</td>
    </tr>
</table>
<h2 id="枚举类型">枚举类型</h2>
<p>枚举定义只能是定义整数类的值，其占用的字节数、有无符号性，通过基类标识指定。</p>
<p>如下所示：</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">enum</span> <span class="nc">Color</span><span class="o">:</span><span class="n">uint32</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Red</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Black</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="结构体">结构体</h2>
<p>结构体在airlang中是值类型，不会进入GC系统，除通过API分配独立的堆内存。</p>
<p>一般用于构成类中的共同属性。</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Vec2</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Vec3</span> <span class="o">:</span><span class="n">Vec2</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32</span> <span class="n">z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="联合体">联合体</h2>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">union</span> <span class="nc">Int32</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32</span> <span class="n">i32</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">int8</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">v4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="接口">接口</h2>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">interface</span> <span class="n">IEvent</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">eat</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="类">类</h2>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Parent</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">int32</span> <span class="n">i32</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="kt">void</span> <span class="nf">doing</span><span class="p">(){}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Child</span> <span class="o">:</span><span class="n">Parent</span> <span class="o">&lt;</span><span class="n">IEvent</span><span class="o">&gt;</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">int64</span> <span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">eat</span><span class="p">()</span><span class="err">@</span><span class="k">override</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h2 id="委托">委托</h2>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">entrust</span> <span class="n">Func</span> <span class="o">=</span> <span class="kt">void</span> <span class="p">(</span><span class="n">int32</span><span class="p">,</span><span class="n">int64</span><span class="p">)</span><span class="err">@</span><span class="n">clang</span><span class="p">;</span></span></span></code></pre></div>
            <footer class="footline">

            </footer>
          </article>

          </section>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第9章</div>
<h1 id="9-字节码文件格式">9 字节码文件格式</h1>

<p>字节码文件的设计是虚拟机资源加载的核心，其中的设计会影响到虚拟机指令集的设计。</p>
<h2 id="目录">目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
</ul>

            <footer class="footline">

            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第10章</div>
<h1 id="10-虚拟机设计与实现">10 虚拟机设计与实现</h1>

<p>虚拟机的设计与实现，其核心是指令集、字节码文件的设计，这两者包含了虚拟运行的机制。只有明白两者为什么这样设计，才能快速写出执行代码。</p>
<h2 id="目录">目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
</ul>

            <footer class="footline">

            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="图形图像">图形图像</h1>

<h2 id="待续">待续</h2>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="操作系统">操作系统</h1>

<h2 id="待续">待续</h2>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="文件数据格式">文件数据格式</h1>

<h2 id="1-简介">1 简介</h2>
<p>本篇章收集一些文件数据的详细格式格式，为程序开发提供参考。</p>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./6_format/1_general/index.html">1 通用格式设计</a><ul>
	
<li><a href="./6_format/1_general/1_fileheader/index.html">1 文件头</a><ul>
	</ul></li>
<li><a href="./6_format/1_general/2_segmentformat/index.html">2 段节格式</a><ul>
	</ul></li>
<li><a href="./6_format/1_general/3_tlvformat/index.html">3 TLV格式</a><ul>
	</ul></li></ul></li>
<li><a href="./6_format/2_program/index.html">2 程序格式</a><ul>
	
<li><a href="./6_format/2_program/1_elf/index.html">1 ELF 格式</a><ul>
	
<li><a href="./6_format/2_program/1_elf/1_elf32/index.html">1 ELF32 格式</a></li>
<li><a href="./6_format/2_program/1_elf/2_elf64/index.html">2 ELF64 格式</a></li></ul></li></ul></li>
<li><a href="./6_format/3_color/index.html">3 颜色格式</a><ul>
	
<li><a href="./6_format/3_color/1_rgba/index.html">1 RGBA</a><ul>
	</ul></li>
<li><a href="./6_format/3_color/2_hsl/index.html">2 HSL/HSV</a><ul>
	</ul></li>
<li><a href="./6_format/3_color/3_yuv/index.html">3 YUV</a><ul>
	</ul></li>
<li><a href="./6_format/3_color/4_xyz/index.html">4 XYZ</a><ul>
	</ul></li>
<li><a href="./6_format/3_color/5_lab/index.html">5 LAB</a><ul>
	</ul></li>
<li><a href="./6_format/3_color/6_cmyk/index.html">6 CMYK</a><ul>
	</ul></li></ul></li>
<li><a href="./6_format/4_compress/index.html">4 压缩格式</a><ul>
	</ul></li>
<li><a href="./6_format/5_picture/index.html">5 图片格式</a><ul>
	</ul></li>
<li><a href="./6_format/6_video/index.html">6 视频格式</a><ul>
	</ul></li>
<li><a href="./6_format/7_audio/index.html">7 音频格式</a><ul>
	</ul></li>
<li><a href="./6_format/8_model/index.html">8 模型3D</a><ul>
	</ul></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">文件数据格式 的子部分</h1>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第1章</div>
<h1 id="1-通用格式设计">1 通用格式设计</h1>

<h2 id="1-序">1 序</h2>
<hr>
<p>二进制文件的格式一般采用结构 <em><strong>文件头 + 核心内容</strong></em>。</p>
<ul>
<li>文件头：标识文件的基本信息，其设计方法基本一致。</li>
<li>核心内容：这部分是真正的文件数据内容。</li>
</ul>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./6_format/1_general/1_fileheader/index.html">1 文件头</a></li>
<li><a href="./6_format/1_general/2_segmentformat/index.html">2 段节格式</a></li>
<li><a href="./6_format/1_general/3_tlvformat/index.html">3 TLV格式</a></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">1 通用格式设计 的子部分</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="1-文件头">1 文件头</h1>

<hr>
<p>描述了文件的整体信息，常见的字段有魔数、检验码、版本号、文件大小等。</p>
<p>顾名思义，即是将文件的整体信息通常放在文件的开头。</p>
<p>在少数情况下，也会将文件头放在文件的尾部，也就是‘文件尾’，但是一般还是叫做 <em><strong>文件头</strong></em>。</p>
<h3 id="1-魔数">1 魔数</h3>
<hr>
<p>魔数作为文件格式的标识，一般用于识别文件是否程序所能处理的文件。其值可以随意选取，主要看设计者自身的喜好。</p>
<p>例如 zip 格式的魔数就是 <em><strong>&ldquo;PK\x03\x04&rdquo;</strong></em>,其中 PK 就是设计者 Philip Katz 的名字首字母。</p>
<p>一般程序在分析文件时，会先判断魔数的值是否匹配，不匹配就表明文件格式不正确。</p>
<p>需要注意的是，假如魔数正确，文件格式并非一定能够读取正确，还需要进一步判断。</p>
<h3 id="2-检验码">2 检验码</h3>
<hr>
<p>文件头通常还会有个检验码，用于检验文件是否完整并且没有经过修改的。这个检验码可以使用 crc, 可以使用 md5，也可以使用其它算法。</p>
<p>这也是检查文件格式的正确性中的重要一步，因为即便是魔数相同，校验码所采用的算法不同，和校验码所作的位置不同，所计算的校验码，基本上是不一的，所以进一步就，能区分出文件格式是否正确。</p>
<h3 id="3-版本号">3 版本号</h3>
<hr>
<p>文件头通常还会包含版本号。</p>
<p>版本号不同，就表明文件格式发生变化，可能变化很小，也可能变化很大；可能是某些字段的值在解释上发生变化，也可能是直接添加了一些结构。所以导致文件的读取方式可能会有所不同。</p>
<p>版本号有时只是单独一个数字，不断往上递增。有时也会拆分成两个数字，为主版本号和次版本号。主版本号修改，通常表示文件格式发生大变动。而次版本号修改，通常只是表示添加了一些小功能。</p>
<h3 id="4-字节顺序">4 字节顺序</h3>
<hr>
<p>字节顺序在文件格式设计中至关重要。</p>
<p>字节顺序分为大端字节序和小端字节序。不同的机器字节序有可能不同，设计文件格式时需要考虑文件用什么字节序保存数据的。</p>
<p>读取和存储的字节序不一致就会导致程序出错。</p>
<h3 id="5-通用结构">5 通用结构</h3>
<hr>
<p>通用结构定义如下：</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">FileHeader</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">uint8</span> <span class="n">mMagic</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>    <span class="c1">//魔数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">uint8</span> <span class="n">mHash</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>    <span class="c1">//检验码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">uint32</span> <span class="n">mEndian</span><span class="p">;</span>     <span class="c1">//字节序
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">uint32</span> <span class="n">mVersion</span><span class="p">;</span>    <span class="c1">//文件版本
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></div>
            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="2-段节格式">2 段节格式</h1>

<hr>
<p>分段(或叫分节，后续默认叫法为分段)的二进制文件格式是比较常见的，比如编译器 GCC 输出的目标文件一般为 ELF 的分段文件。</p>
<h2 id="1-整体结构">1 整体结构</h2>
<hr>
<p>这类文件一般采用 <em><strong>文件头 + 分段</strong></em> 的结构：</p>
<pre><code>file header 
section 0
section 1
....
section N
</code></pre>
<p>文件头设计方法在 <strong><a href="./6_format/1_general/1_fileheader/">文件头</a></strong> 中介绍，本章节主要描述分段式存储数据的方法。</p>
<h2 id="2-分段方法">2 分段方法</h2>
<hr>
<p>一般有两种结构：</p>
<ul>
<li>分散式：在分区的头部的描述分段的大小等信息。</li>
<li>段表式：存在统一的结构描述分段的大小、相对偏移等信息。</li>
</ul>
<h3 id="分散式">分散式</h3>
<p>分散式分结构在分区的头部的描述分段的大小等信息，然后各个分段首尾相连的，分段写入。</p>
<p>分段的每一个段的结构通常是：</p>
<pre><code>tag + length
section data
</code></pre>
<p>tag 和 length 合起来是分区头部，描述分段中的数据标识，后面紧跟着体数据。</p>
<p>tag 一般是一个整数，用来标识分区的类型。不同的分区用不同的 tag 值表示，不同的分区种类可以使用不同的读取方式。</p>
<p>整体结构如下：</p>
<pre><code>file header 
section 0
            tag     //section 0 的标识
            length  //section 0 的数据长度
            data[]  //section 0 的数据
section 1
....
section N
</code></pre>
<h3 id="段表式">段表式</h3>
<p>段表式的结构是有一个描述分段信息的段表，后面存储各个分区的数据。</p>
<p>主要优点就是，可以通过段描述表(简称段表)快速的访问分段的内容，其格式如下。</p>
<pre><code>section table
section 0
section 1
....
section N
</code></pre>
<p>段表一般描述分段的类型、数据长度、相对偏移等，结构如下。</p>
<pre><code>kind
length
offset
</code></pre>
<p>C 语言定义如下：</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">SegTabItem</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">uint32</span> <span class="n">kind</span><span class="p">;</span>    <span class="c1">//类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">uint32</span> <span class="n">length</span><span class="p">;</span>  <span class="c1">//数据长度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">uint32</span> <span class="n">offset</span><span class="p">;</span>  <span class="c1">//相对偏移
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></div><p>整体结构如下：</p>
<pre><code>file header 
section table
                kind    //section 0 的类型
                length  //section 0 的数据长度
                offset  //section 0 的相对偏移
                kind    //section 1 的类型
                length  //section 1 的数据长度
                offset  //section 1 的相对偏移
                ...
                kind    //section N 的类型
                length  //section N 的数据长度
                offset  //section N 的相对偏移
section 0
section 1
....
section N</code></pre>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="3-tlv格式">3 TLV格式</h1>

<hr>
<h2 id="1-简介">1 简介</h2>
<hr>
<p>TLV 是一种可变的格式，由三个域构成：标识域（Tag）+长度域（Length）+值域（Value），简称TLV格式。</p>
<p>其中：</p>
<ul>
<li>T 可以理解为 Tag 或 Type ，用于标识标签或者编码格式信息；</li>
<li>L 定义数值的长度；</li>
<li>V 表示实际的数值。</li>
</ul>
<p>T 和 L 的长度固定，一般是2或4个字节，V 的长度由 Length 指定。</p>
<ul>
<li>T 和 L 一般都是整数值。</li>
<li>V 可以存储整数、浮点、字符串、字节串，其类型是由格式定义者根据 T 的不同值，指定不同的类型。</li>
</ul>
<h2 id="2-基本结构">2 基本结构</h2>
<hr>
<pre><code>data 0
    T = 1
    L = 1
    V = 1
data 1
    T = 1
    L = 1
    V = 2
...
data N
    T = 1
    L = 1
    V = n
</code></pre>
<p>当然V中的数据也是可以嵌套,至于嵌套几层看设计者的规定的。</p>
<p>结构如下：</p>
<pre><code>data 0
    T = 1
    L = 3
    V =[
            data x
            T = 1
            L = 1
            V = 1
        ]
data 1
    T = 1
    L = 1
    V = 2
...
data N
    T = 1
    L = 1
    V = n</code></pre>

            <footer class="footline">

            </footer>
          </article>

          </section>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第2章</div>
<h1 id="2-程序格式">2 程序格式</h1>

<h2 id="1-序">1 序</h2>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./6_format/2_program/1_elf/index.html">1 ELF 格式</a><ul>
	
<li><a href="./6_format/2_program/1_elf/1_elf32/index.html">1 ELF32 格式</a></li>
<li><a href="./6_format/2_program/1_elf/2_elf64/index.html">2 ELF64 格式</a></li></ul></li>
</ul>
            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">2 程序格式 的子部分</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="1-elf-格式">1 ELF 格式</h1>

<h2 id="1-序">1 序</h2>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./6_format/2_program/1_elf/1_elf32/index.html">1 ELF32 格式</a><ul>
	</ul></li>
<li><a href="./6_format/2_program/1_elf/2_elf64/index.html">2 ELF64 格式</a><ul>
	</ul></li>
</ul>
            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">1 ELF 格式 的子部分</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="1-elf32-格式">1 ELF32 格式</h1>


            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="2-elf64-格式">2 ELF64 格式</h1>


            <footer class="footline">

            </footer>
          </article>

          </section>
          </section>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第3章</div>
<h1 id="3-颜色格式">3 颜色格式</h1>

<h2 id="1-序">1 序</h2>
<hr>
<p>颜色常用颜色空间来表示。颜色空间是用一种数学方法形象化表示颜色，人们用它来指定和产生颜色。例如，</p>
<ul>
<li>对于人来说，我们可以通过色调、饱和度和明度来定义颜色；</li>
<li>对于显示设备来说，人们使用红、绿和蓝磷光体的发光量来描述颜色；</li>
<li>对于打印或者印刷设备来说，人们使用青色、品红色、黄色和黑色的反射和吸收来产生指定的颜色。</li>
</ul>
<p>颜色空间有设备相关和设备无关之分。</p>
<p>设备相关的颜色空间是指颜色空间指定生成的颜色与生成颜色的设备有关。例如，RGB颜色空间是与显示系统相关的颜色空间，计算机显示器使用RGB来显示颜色，用像素值(例如，R＝250,G＝123,B＝23)生成的颜色将随显示器的亮度和对比度的改变而改变。</p>
<p>设备无关的颜色空间是指颜色空间指定生成的颜色与生成颜色的设备无关，例如，CIE Lab*颜色空间就是设备无关的颜色空间，它构建在HSV(hue, saturation and value)颜色空间的基础上，用该空间指定的颜色无论在什么设备上生成的颜色都相同。</p>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
<li><a href="./6_format/3_color/1_rgba/index.html">1 RGBA</a></li>
<li><a href="./6_format/3_color/2_hsl/index.html">2 HSL/HSV</a></li>
<li><a href="./6_format/3_color/3_yuv/index.html">3 YUV</a></li>
<li><a href="./6_format/3_color/4_xyz/index.html">4 XYZ</a></li>
<li><a href="./6_format/3_color/5_lab/index.html">5 LAB</a></li>
<li><a href="./6_format/3_color/6_cmyk/index.html">6 CMYK</a></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">3 颜色格式 的子部分</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="1-rgba">1 RGBA</h1>


            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="2-hslhsv">2 HSL/HSV</h1>


            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="3-yuv">3 YUV</h1>


            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="4-xyz">4 XYZ</h1>


            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="5-lab">5 LAB</h1>


            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="6-cmyk">6 CMYK</h1>


            <footer class="footline">

            </footer>
          </article>

          </section>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第4章</div>
<h1 id="4-压缩格式">4 压缩格式</h1>

<h2 id="1-序">1 序</h2>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
</ul>
            <footer class="footline">

            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第5章</div>
<h1 id="5-图片格式">5 图片格式</h1>

<h2 id="1-序">1 序</h2>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
</ul>
            <footer class="footline">

            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第6章</div>
<h1 id="6-视频格式">6 视频格式</h1>

<h2 id="1-序">1 序</h2>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
</ul>
            <footer class="footline">

            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第7章</div>
<h1 id="7-音频格式">7 音频格式</h1>

<h2 id="1-序">1 序</h2>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
</ul>
            <footer class="footline">

            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">第8章</div>
<h1 id="8-模型3d">8 模型3D</h1>

<h2 id="1-序">1 序</h2>
<h2 id="2-目录">2 目录</h2>
<hr>

<ul class="children children-li children-sort-weight">
	
</ul>
            <footer class="footline">

            </footer>
          </article>

          </section>
          </section>
        </div>
      </main>
    </div>
    <script src="./js/clipboard.min.js?1696231135" defer></script>
    <script src="./js/perfect-scrollbar.min.js?1696231135" defer></script>
    <script src="./js/theme.js?1696231135" defer></script>
  </body>
</html>
